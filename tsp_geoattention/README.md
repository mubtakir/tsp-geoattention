# 🗺️ TSP-GeoAttention Solver

حل هجين مبتكر لمسألة البائع المتجول (Traveling Salesman Problem - TSP) يجمع بين **الهندسة المكانية**، **مبدأ الفعل الأدنى من الفيزياء**، و**آلية الانتباه من نماذج الترانسفورمر**.

## 🎯 الفكرة الأساسية

### المشكلة
مسألة البائع المتجول (TSP) هي مشكلة NP-Hard كلاسيكية: إيجاد أقصر مسار يزور جميع المدن مرة واحدة فقط.

### الحل الهجين
نجمع بين ثلاثة مفاهيم:

1. **🏙️ الهندسة المكانية (Geo-Zoning)**
   - تقسيم المدينة إلى أحياء (خلايا) بناءً على شبكة منتظمة
   - تقليل فضاء البحث من O(n!) إلى مشاكل أصغر

2. **⚛️ مبدأ الفعل الأدنى (Principle of Least Action)**
   - من الفيزياء الكلاسيكية: الجسيم يسلك المسار ذو الطاقة الأدنى
   - تطبيق: اختيار المسار ذو التكلفة الأدنى

3. **🧠 آلية الانتباه (Attention Mechanism)**
   - من نماذج الترانسفورمر: استخدام softmax لاختيار أفضل الخيارات
   - تطبيق: اختيار المدينة التالية بناءً على القرب والعلاقات

## ✨ الميزات

- ✅ **واجهة تفاعلية** عبر Streamlit
- ✅ **ثلاث طرق لإدخال البيانات**:
  - بيانات عشوائية
  - تحميل ملفات TSPLIB
  - رسم يدوي
- ✅ **دعم نوعين من المسافات**:
  - إقليدية (Euclidean) للمشاكل التجريدية
  - جوية (Great-circle/Haversine) للمدن الحقيقية
- ✅ **مقارنة تلقائية مع الحل الأمثل** (لـ n ≤ 10)
- ✅ **تصدير النتائج** (CSV و PNG)
- ✅ **وحدات اختبار شاملة**

## 🚀 البدء السريع

### المتطلبات
- Python 3.8+
- pip

### التثبيت

```bash
# استنساخ المستودع أو تحميل الملفات
cd tsp_geoattention

# تثبيت المتطلبات
pip install -r requirements.txt
```

### التشغيل المحلي

```bash
streamlit run app.py
```

سيفتح المتصفح تلقائيًا على: `http://localhost:8501`

## 📊 مثال الاستخدام

```python
from tsp_solver import TSPGeoAttention
import numpy as np

# إنشاء مدن عشوائية
np.random.seed(42)
cities = [(np.random.rand() * 100, np.random.rand() * 100) for _ in range(10)]

# إنشاء الحل
solver = TSPGeoAttention(cities, grid_size=3, distance_type='euclidean')

# حل المسألة
tour = solver.solve()
distance = solver.get_tour_distance(tour)

print(f"المسار: {tour}")
print(f"المسافة الكلية: {distance:.2f}")
```

## 🧪 تشغيل الاختبارات

```bash
python -m unittest test_tsp_solver.py -v
```

## 📁 هيكل المشروع

```
tsp_geoattention/
├── app.py                    # واجهة Streamlit التفاعلية
├── tsp_solver.py             # محرك الحل الهجين
├── test_tsp_solver.py        # وحدات الاختبار
├── requirements.txt          # التبعيات
├── README.md                 # هذا الملف
└── .streamlit/
    └── config.toml          # تكوين Streamlit
```

## 🔧 الخوارزمية بالتفصيل

### الخطوات الرئيسية

1. **تقسيم المساحة**
   - حساب المربع المحيط (Bounding Box)
   - تقسيمه إلى شبكة من الخلايا

2. **تعيين المدن**
   - تعيين كل مدينة إلى الخلية المناسبة

3. **المسح الحلزوني**
   - ترتيب الخلايا من المحيط إلى المركز

4. **الانتباه بين الخلايا**
   - اختيار ترتيب الخلايا بناءً على المسافة

5. **حل محلي**
   - حل TSP محلي داخل كل خلية باستخدام Nearest Neighbor + Attention

6. **التحسين العالمي**
   - تطبيق 2-opt لتحسين المسار الكامل

## 📈 الأداء

### التعقيد الزمني
- **الحل الأمثل**: O(n!)
- **الحل التقريبي**: O(n² log n) تقريبًا

### النتائج التجريبية
- للمشاكل الصغيرة (n ≤ 10): خطأ < 5% من الأمثل
- للمشاكل الكبيرة (n > 100): حل معقول في وقت قصير

## 🌐 النشر على Streamlit Cloud

1. أنشئ مستودعًا على GitHub
2. أضف جميع الملفات
3. اذهب إلى [Streamlit Cloud](https://streamlit.io/cloud)
4. اختر المستودع وانقر Deploy

## 📚 المراجع

- Traveling Salesman Problem: https://en.wikipedia.org/wiki/Travelling_salesman_problem
- Attention Mechanism: https://arxiv.org/abs/1706.03762
- TSPLIB: https://www.math.uwaterloo.ca/tsp/

## 👨‍🔬 الباحث

**باسل يحيى عبدالله**

## 📝 الترخيص

MIT License - حرية الاستخدام والتعديل لأغراض تعليمية وتجارية

## 🤝 المساهمة

نرحب بالمساهمات والاقتراحات!

---

**ملاحظة**: هذا حل تقريبي ولا يضمن الأمثلية، لكنه فعّال عمليًا للمشاكل الكبيرة.

