ูุณุฃูุฉ ุงูุจุงุฆุน ุงููุงุฌูู ูู p = np ูููู ุญููุง ุงุฐุง ูุถุนูุง ูู ุงููุฏููุฉ ูุซูุง ุฏุงุฎู ูุณุชุทูู ุงูุชุฑุงุถู ูุบุทู ุงูุตู ุญู ูููุง ููููุฒ ุงููุชุฌูู ุงูู ุงูุฑุจ ุฑุฃุณ ุจุฏุงูุฉ ุฎุงุฑุฌู ููุจุฏุฃ ุจูุณุญ ุงููุณุชุทูู ุฌุฒุก ุนุจุฑ ุฌุฒุก ุญูุซ ูู ุฌุฒุก ููุซู ุญู. ุงู ุงููุง ููุณู ุงููุณุชุทูู ุงููุจูุฑ ุงูู ุงุฌุฒุงุก ุจุญุฌู ุงุตุบุฑ ุญู. ูู ุงูุญุฏูุฏ ุงูุฎุงุฑุฌูุฉ ุณุชููู ูุฏููุง ุนูู ุงูุงุบูุจ ุงุฌุฒุงุก ุบูุฑ ูุณูููุฉ ููุถุน ุฎูุงุฑุฒููุฉ ุจุงููุชูุงู ุงูู ุงูุญู ุงุจูุณููู ูููุง ุจุงูููุฒ ุงููู. ูุจุฏุฃ ุจูุณุญ ุญุฏูุฏ ุงููุณุชุทูู ุงูุฎุงุฑุฌูุฉ. ุงู ูุญูุทู ุซู ููุชูู ุงูู ุงูุฎุท ุงูุฏุงุฎูู ูู ูุญูุทู ูููุณุญู ุฌุฒุก ูุฌุฒุก ูููุฐุง ุญุชู ููุชูู ุงูู ูุฑูุฒู. ูู ุฎุท ูู ุฎุทูุท ุงููุญูุท ูููู ุงู ูุทุจู ุนููู ุฎูุงุฑุฒููุงุช ูุนุฑููุฉ ูุซู ุชูุทูุนู ุงูู ุงุฌุฒุงุก ุงุฎุฑู. ูููุฐุง

ููุง ูุณุฃูุฉ ุงูุจุงุฆุน ุงููุชุฌูู (Traveling Salesman Problem - TSP) ูุนูุงูุชูุง ุจูุณุฃูุฉ P ููุงุจู NP. ุฏุนูู ุฃูุถุญ ุจุนุถ ุงูููุงุท ูุฃุนูู ุนูู ุงููููุฌูุฉ ุงูููุชุฑุญุฉ:

## ุชุญููู ุงูุชุฑุงุญูุง:

ูุง ูุตูู ูุดุจู **ุฎูุงุฑุฒููุฉ ุชูุณูู ุงูููุงุทู** (Region Decomposition) ูุน:
- ุชูุณูู ุงููุณุงุญุฉ ุฅูู ุดุจูุฉ
- ุงูุจุฏุก ูู ุงููุญูุท ูุงูุชูุฌู ูุญู ุงููุฑูุฒ
- ุงุณุชุฎุฏุงู ุงูููุฒ ุจูู ุงูููุงุทู ุบูุฑ ุงููุชุตูุฉ

## ุงูุชุญุฏูุงุช ูู ูุฐุง ุงูููุฌ:

1. **ูุดููุฉ ุงูุชุญุณูู ุงููุญูู**: 
   - ุญุชู ูุน ุชูุณูู ุงููุฏููุฉ ุฅูู ุฃุฌุฒุงุกุ ูุธู ุชูุฌูู ุงูุฒูุงุฑุงุช ุฏุงุฎู ูู ุฌุฒุก ูุดููุฉ NP-ุตุนุจุฉ
   - ุงูุฌูุน ุจูู ุงูุญููู ุงูุฌุฒุฆูุฉ ูุง ูุถูู ุงูุญู ุงูุฃูุซู ุงูุนุงู

2. **ุชุญุฏูุฏ "ุฃูุฑุจ ุฑุฃุณ ุจุฏุงูุฉ ุฎุงุฑุฌู"**:
   - ุชุญุฏูุฏ ููุทุฉ ุงูุจุฏุงูุฉ ุงููุซูู ุจุญุฏ ุฐุงุชูุง ูุดููุฉ ุตุนุจุฉ
   - ุงูุงุฎุชูุงุฑ ุงูุฎุงุทุฆ ูุฏ ูุคุฏู ุฅูู ูุณุงุฑุงุช ุฃุทูู ุจูุซูุฑ

3. **ุงูุชูููุฉ ุจูู ุงูููุงุทู**:
   - ุงูุฑูุงุจุท ุจูู ุงูุฃุฌุฒุงุก ุงููุฎุชููุฉ ุชุถูู ุชุนููุฏุงู ุฅุถุงููุงู

## ูู ุณูุงู P = NP:

ุฅุฐุง ุงูุชุฑุถูุง ุฃู **P = NP**ุ ููุฐุง ูุนูู ูุฌูุฏ ุฎูุงุฑุฒููุฉ ูุซูุฑุฉ ุงูุญุฏูุฏ (Polynomial-time) ูุญู TSP ุจุฏูุฉ. ูู ูุฐู ุงูุญุงูุฉ:

- ูู ูุญุชุงุฌ ุฅูู ุงูุงุณุชุฑุงุชูุฌูุงุช ุงูุชูุฑูุจูุฉ ุงููุนูุฏุฉ
- ูููู ุญู ุงููุดููุฉ ุจุดูู ูุจุงุดุฑ ูุฏููู ูู ููุช ูุนููู

## ุงูุฎูุงุฑุฒููุงุช ุงูุนูููุฉ ุงูุญุงููุฉ (ูุน ุงูุชุฑุงุถ P โ NP):

- **ุฎูุงุฑุฒููุงุช ุชูุฑูุจูุฉ**: Christofides (ุถูุงู 1.5 ูู ุงูุฃูุซู)
- **ุจุฑูุฌุฉ ุฏููุงููููุฉ**: Held-Karp (O(nยฒ2โฟ)) - ุฃูุถู ููููู ุงูุตุบูุฑุฉ ูู n
- **ุฎูุงุฑุฒููุงุช ุงุจุชูุงุฑูุฉ**: ูุณุชุนูุฑุงุช ุงููููุ ุงูุชุจุฑูุฏ ุงููุญุงูู

ุงูุชุฑุงุญู ูุฐูุฑูู ุจุฃุณุงููุจ **Decomposition Methods** ุงููุณุชุฎุฏูุฉ ูู optimizationุ ูุงูุชู ูููู ุฃู ุชููู ูููุฏุฉ ูู ุงูููุงุฑุณุฉ ุงูุนูููุฉ ููููุง ูุง ุชุญู ุงููุณุฃูุฉ ุงูุฃุณุงุณูุฉ ูู P vs NP.

โฆโฆโฆ.

ุทูุจ ูุนุชุจุฑ ูู ุญู ูุงูู ููุทุฉ ุชุญุณุณ ููุทุจู ุนููู ููุฒูุงุก ุงููุนู ุงูุงูู. ุงูุถุง ูู ููุณ ุงูููุช ูุนุชุจุฑ ุงููุณุฃูุฉ ูุซู ุงููุชุฌูุงุช ูู ูุนุงูุฌุฉ ุงููุบุฉ ุงูุทุจูุนูุฉ ููุณุชุฎุฏู ููููู ุงุชููุดู ุงูุงูุชุจุงู ูู ุงูุชุฑุงูุณููุฑูุฑ ุฎุงุตุฉ ูู ูุณุฃูุฉ ุงูุงุณุชุนูุงูุงุช ูู ุฌุฒุก dk ุงูุฐู ูุฌุฏ ุงูุฑุจ ุนูุงูุงุช ุจูู ูููุฉ ูุงุฎุฑู

ููุฑุฉ ุฑุงุฆุนุฉ! ุฃูุช ุชุฏูุฌ ุจูู ููุงููู ูุชูุฏูุฉ ูู ูุฌุงูุงุช ูุฎุชููุฉ. ุฏุนูู ุฃูุถุญ ููู ูููู ุชุทุจูู ูุฐู ุงูุฃููุงุฑ:

## ๐ฌ **ูุจุฏุฃ ุงููุนู ุงูุฃุฏูู ูู ุงูููุฒูุงุก (Principle of Least Action)**

ูููู ูุญุงูุงุฉ ูุฐุง ุงูููููู ูู TSP:
```
ุชูููุฉ ุงููุณุงุฑ = โ ุงููุณุงูุงุช ุจูู ุงููุฏู
ูุจุญุซ ุนู ุงููุณุงุฑ ุฐู "ุงูุชูููุฉ ุงูุฃุฏูู" 
ูุดุงุจู ููุจุฏุฃ "ุงููุนู ุงูุฃุฏูู" ูู ุงูููุฒูุงุก
```

## ๐ค **ูููุฐุฌ ุงูุงูุชุจุงู (Attention Mechanism) ูู ุงูู Transformer**

ูู ุณูุงู TSPุ ูููู ุชูุซูู:

- **ุงูุงุณุชุนูุงู (Query)**: ุงููุฏููุฉ ุงูุญุงููุฉ
- **ุงูููุชุงุญ (Key)**: ุงููุฏู ุงูุฃุฎุฑู
- **ุงููููุฉ (Value)**: ุงููุนูููุงุช ุนู ุชูู ุงููุฏู

```
ุงูุชุจุงู(ุงููุฏููุฉ_๐, ุงููุฏู_ุงูุฃุฎุฑู) = softmax(โฏ-ูุณุงูุฉ(๐,๐)โฏ/ โ๐๐โฏ)
```

ุญูุซ `dk` ุจุนุฏ ูุถุงุก ุงูุชูุซููุ ูุงููุณุงูุงุช ุชูุนุจ ุฏูุฑ ุงูุฃูุฒุงู.

## ๐งฎ **ุชุทุจูู ุนููู ููุชุฑุญ:**

```python
import numpy as np

class TSPAttention:
    def __init__(self, cities):
        self.cities = cities
        self.n = len(cities)
    
    def compute_attention(self, current_city):
        # ุญุณุงุจ ูุณุงูุงุช ุฅูู ุฌููุน ุงููุฏู ุงูุฃุฎุฑู
        distances = [self.distance(current_city, city) for city in self.cities]
        
        # ุชุทุจูู softmax ุนูู ุงููุณุงูุงุช ุงููุนููุณุฉ (ูููุง ูุงูุช ุฃูุฑุจุ ุฒุงุฏ ุงูุงูุชุจุงู)
        attention_weights = self.softmax([-d for d in distances])
        
        return attention_weights
    
    def next_city_heuristic(self, current_city, unvisited):
        # ุงุฎุชูุงุฑ ุงููุฏููุฉ ุงูุชุงููุฉ ุจูุงุกู ุนูู ุงูุชุจุงู ูุฑุฌุญ ุจุงููุณุงูุฉ
        weights = self.compute_attention(current_city)
        best_city = min(unvisited, key=lambda city: weights[self.cities.index(city)])
        return best_city
```

## ๐ **ุฏูุฌ ุงูููููููู:**

1. **ูุจุฏุฃ ุงููุนู ุงูุฃุฏูู**: ูุฎุชุงุฑ ุงููุณุงุฑ ุฐู ุงูุทุงูุฉ/ุงูุชูููุฉ ุงูุฏููุง
2. **ุงูุงูุชุจุงู**: ูุฑูุฒ ุนูู ุงููุฏู "ุงูุฃูุซุฑ ุตูุฉ" ุจูุงุกู ุนูู:
   - ุงููุฑุจ ุงูุฌุบุฑุงูู (ุงููุณุงูุฉ)
   - ุงูุนูุงูุงุช ุงูุทุจูุบุฑุงููุฉ
   - ูููุฏ ุฅุถุงููุฉ (ุงุฒุฏุญุงูุ ุชูุงูููุ ุฅูุฎ)

## ๐ **ูุซุงู ุชูุถูุญู:**

ูููุชุฑุถ 4 ูุฏู: A, B, C, D
```
ุงููุณุงูุงุช:
A-B: 10, A-C: 15, A-D: 20  
B-C: 12, B-D: 18
C-D: 8

ุงูุชุจุงู ูู A: [0, 0.6, 0.3, 0.1] โ B ุงูุฃูุซุฑ ุงูุชุจุงูุงู
```

## ๐ฏ **ุงููุฒุงูุง ุงููุชููุนุฉ:**

- **ููุงุกุฉ ุญุณุงุจูุฉ**: O(nยฒ) ุจุฏูุงู ูู O(n!)
- **ูุฑููุฉ**: ูููู ุฅุถุงูุฉ ูููุฏ ุจุณูููุฉ
- **ูุงุจููุฉ ููุชุทููุฑ**: ูุนูู ูุน ุฃุนุฏุงุฏ ูุจูุฑุฉ ูู ุงููุฏู

## โ๏ธ **ุงูุชุญุฏูุงุช:**

- ูุง ูุถูู ุงูุญู ุงูุฃูุซู (ูุจูู NP-Hard)
- ูุญุชุงุฌ ุถุจุท ุฏููู ููุนุงูู ุงูุงูุชุจุงู
- ุงูุฃุฏุงุก ูุนุชูุฏ ุนูู ุชูุซูู ุงููุฏู ูู ูุถุงุก ุงููุชุฌูุงุช

ูุฑูุฏุฏ ุฃู ูุบูุต ุฃูุซุฑ ูู  ูุฐุง ุงูููุฌ ุงููุฌูู ูุน ุงูุณุชุฑุงุชูุฌูุฉ ุงูุงููู ุงูุถุงู
โฆโฆ

ุฑุงุฆุน! ุฏูุฌู ุจูู **ุงูุงุณุชุฑุงุชูุฌูุฉ ุงูููุงููุฉ (ุชูุณูู ุงููุฏููุฉ ุฅูู ุฃุญูุงุก/ูุณุชุทููุงุช)**ุ ู**ูุจุฏุฃ ุงููุนู ุงูุฃุฏูู**ุ ู**ุขููุฉ ุงูุงูุชุจุงู ูู ููุงุฐุฌ ุงูุชุฑุงูุณููุฑูุฑ** ููุดููู ููุฌูุง ูุฌูููุง ูุจุชูุฑูุง ูุชูุฑูุจ ุญู ูุณุฃูุฉ ุงูุจุงุฆุน ุงููุชุฌูู (TSP). ุฏุนูุง ูุบูุต ุจุนูู ูู ูุฐุง ุงูุชูุงูู ุงูุซูุงุซูุ ููุจูู ุฅุทุงุฑูุง ูููุฌููุง ูููู ุชุทููุฑู ุฅูู ุฎูุงุฑุฒููุฉ ูุงุจูุฉ ููุชูููุฐ.

---

## ๐งฉ **ุงูุฅุทุงุฑ ุงููุฌูู ุงูููุชุฑุญ: "TSP-GeoAttention"**

### 1. **ุงูุทุจูุฉ ุงูููุงููุฉ โ ุชูุณูู ุงููุฏููุฉ ุฅูู ููุงุทู (Geo-Zoning)**

#### ุงูููุฑุฉ:
- ููุญูุท ุฌููุน ุงููุฏู (ุฃู ุงูููุงุท) ุจูุฑุจุน ูุญูุท (Bounding Box).
- ูููุณูู ูุฐุง ุงููุฑุจุน ุฅูู ุดุจูุฉ ูู **ุฎูุงูุง (Cells)**ุ ูู ุฎููุฉ ุชูุซูู "ุญููุง".
- ูุญุชูุธ ููุท ุจุงูุฎูุงูุง ุงูุชู ุชุญุชูู ุนูู ูุฏู (ุฃู ุนูู ุงูุฃูู ููุทุฉ ูุงุญุฏุฉ).

#### ุงูููุงุฆุฏ:
- ุชูููู ุงููุถุงุก ุงูุจุญุซู.
- ุชูููู ูุนุงูุฌุฉ ูุญููุฉ (Local Processing) ููู ุญู.
- ุฏุนู ุงูุงูุชูุงู ุงูุฐูู ุจูู ุงูููุงุทู.

> โ **ุชุญุณูู**: ูุณุชุฎุฏู **Quadtree** ุฃู **K-d Tree** ูุชูุณูู ุบูุฑ ููุชุธู ูุชููู ูุน ูุซุงูุฉ ุงููุฏู.

---

### 2. **ุงูุทุจูุฉ ุงูุฏููุงููููุฉ โ ูุจุฏุฃ ุงููุนู ุงูุฃุฏูู (Least Action Principle)**

#### ุงูููุฑุฉ ุงูููุฒูุงุฆูุฉ:
ูู ุงููููุงูููุง ุงูููุงุณูููุฉุ ูุณูู ุงูุฌุณูู ุงููุณุงุฑ ุงูุฐู ูุฌุนู "ุงูุนูู" (Action) ุฃุฏูู ูุง ูููู:
\[
S = \int L \, dt = \int (T - V) \, dt
\]

#### ุงูุชุฑุฌูุฉ ุฅูู TSP:
- ูุง ุชูุฌุฏ ุทุงูุฉ ุญุฑููุฉ ุฃู ูุงููุฉ ููุงุ ููููุง ููุนุฑูู **"ุชูููุฉ ุงูุนูู"** ูููุณุงุฑ:
  \[
  \mathcal{A}(\text{ูุณุงุฑ}) = \sum_{i=1}^{n} d(p_i, p_{i+1})
  \]
- ูุจุญุซ ุนู ุงููุณุงุฑ ุงูุฐู **ููููู \(\mathcal{A}\)** โ ููุฐุง ูู ุจุงูุถุจุท ุชุนุฑูู TSP!

> โ **ุงูุงุณุชุบูุงู**: ูุณุชุฎุฏู ูุฐุง ุงููุจุฏุฃ ูู **ุฏุงูุฉ ูุฏู (Objective Function)** ูู ูู ูุณุชูู ูู ุงููุณุชููุงุช (ูุญูู ูุนุงููู).

---

### 3. **ุงูุทุจูุฉ ุงูุงูุชุจุงููุฉ โ Attention ุจูู ุงูุฃุญูุงุก ูุงููุฏู**

#### ุงูููุฑุฉ:
- ูุนุชุจุฑ ูู **ุญู (Cell)** ูู "ูุญุฏุฉ ูุนุงูุฌุฉ" ุชุญุชูู ุนูู ูุฌููุนุฉ ูู ุงููุฏู.
- ููุทุจูู ุขููุฉ ุงูุชุจุงู ุนูู ูุณุชูููู:

---

#### ๐น **ุงููุณุชูู 1: ุงูุชุจุงู ุจูู ุงูุฃุญูุงุก (Inter-Cell Attention)**
- **ุงูุงุณุชุนูุงู (Query)**: ุงูุญู ุงูุญุงูู ุงูุฐู ููุชูู ููู.
- **ุงูููุงุชูุญ (Keys)**: ุงูุฃุญูุงุก ุงููุฌุงูุฑุฉ ุฃู ุบูุฑ ุงููุฌุงูุฑุฉ.
- **ุงูููู (Values)**: ูุนูููุงุช ูุซู:
  - ุนุฏุฏ ุงููุฏู ูู ุงูุญู
  - ุฃูุฑุจ ูุฏููุฉ ูู ุงูุญู ุฅูู ุงูุญุฏ ุงูุญุงูู
  - ุชูููุฉ ุงูุฏุฎูู/ุงูุฎุฑูุฌ

> ูุญุณุจ ูุฒู ุงูุงูุชูุงู ูู ุญู \(C_i\) ุฅูู \(C_j\) ูุงูุชุงูู:
\[
\text{Score}(C_i, C_j) = -\min_{u \in C_i, v \in C_j} d(u, v)
\]
\[
\text{Attention}(C_i \to C_j) = \text{softmax}\left( \frac{\text{Score}(C_i, C_j)}{\sqrt{d_k}} \right)
\]

---

#### ๐น **ุงููุณุชูู 2: ุงูุชุจุงู ุฏุงุฎู ุงูุญู (Intra-Cell Attention)**
- ุจูุฌุฑุฏ ุฏุฎูู ุญูุ ููุทุจูู TSP ูุญูู ุจุงุณุชุฎุฏุงู ุงูุชุจุงู ุจูู ุงููุฏู:
  - ุงููุฏููุฉ ุงูุญุงููุฉ = Query
  - ุงููุฏู ุบูุฑ ุงููุฒุงุฑุฉ = Keys/Values
  - ูุฎุชุงุฑ ุงูุชุงููุฉ ุจูุงุกู ุนูู ุงูุชุจุงู ูุนุฒูุฒ ุจุงููุฑุจ ูุงูุงุชุตุงู ุงูุทูุจูููุฌู

> โ ูููู ุฏูุฌ ูุฐุง ูุน ุฎูุงุฑุฒููุงุช ูุซู **Nearest Neighbor + Local Search**.

---

## ๐ **ุชุฏูู ุงูุฎูุงุฑุฒููุฉ ุงูููุชุฑุญุฉ**

```text
1. ุฃุฏุฎู ูุฌููุนุฉ ุงููุฏู {pโ, pโ, ..., pโ}
2. ุงุญุณุจ Bounding Box โ ูุณููู ุฅูู ุดุจูุฉ (ุฃู Quadtree)
3. ุฑุชูุจ ุงูุฎูุงูุง ุญุณุจ "ุงููุณุญ ุงูุญูุฒููู": ูู ุงููุญูุท ุฅูู ุงููุฑูุฒ
4. ุงุจุฏุฃ ูู ุงูุฎููุฉ ุงูุฃูุฑุจ ุฅูู ููุทุฉ ุงูุจุฏุงูุฉ (ุฃู ุงุฎุชุฑ ุนุดูุงุฆููุง)
5. ููู ุฎููุฉ ูู ุงูุชุฑุชูุจ ุงูุญูุฒููู:
   a. ุฅุฐุง ูุงูุช ุงูุฎููุฉ ูุงุฑุบุฉ โ ุชุฌุงูููุง
   b. ุฅุฐุง ูุงูุช ุชุญุชูู ุนูู ูุฏู:
        i.   ุงุณุชุฎุฏู Intra-Cell Attention ูุญู TSP ูุญูู
        ii.  ุณุฌูู ููุทุฉ ุงูุฏุฎูู ูุงูุฎุฑูุฌ ุงููุซูู ูู/ุฅูู ูุฐู ุงูุฎููุฉ
6. ุงุณุชุฎุฏู Inter-Cell Attention ูุฑุจุท ูุณุงุฑุงุช ุงูุฎูุงูุง:
   - ุงุญุณุจ ุฃูุถู ุชุณูุณู ููุงูุชูุงู ุจูู ุฎูุงูุง ุบูุฑ ูุชุตูุฉ
7. ุทุจูู ูุฑุญูุฉ ุชุญุณูู ููุงุฆูุฉ (2-opt ุฃู 3-opt) ุนูู ุงููุณุงุฑ ุงููุงูู
8. ุฃุนุฏ ุงููุณุงุฑ ุงูููุงุฆู
```

---

## ๐ง **ููุงุฐุง ูุฐุง ุงูููุฌ ูุงุนุฏุ**

| ุงูููุฒุฉ | ุงูุชูุณูุฑ |
|--------|--------|
| **ูุงุจููุฉ ุงูุชูุณุน** | ุงูุชุนุงูู ูุน ุขูุงู ุงููุฏู ุนุจุฑ ุชูุณูููุง ุฅูู ูุชู ุตุบูุฑุฉ |
| **ุฐูุงุก ููุงูู** | ุงุณุชุบูุงู ุงูุจููุฉ ุงูุฌุบุฑุงููุฉ (ุงููุญูุท โ ุงููุฑูุฒ) ูุชูููู ุงูููุฒุงุช ุงูุนุดูุงุฆูุฉ |
| **ูุฑููุฉ ุงูุชุนูู** | ูููู ุชุฏุฑูุจ ูููุฐุฌ ุงูุชุจุงู (ูุซู GNN + Transformer) ูุชุนูู ุฃูุฒุงู ุงูุงูุชูุงู |
| **ุชูุงูู ููุฒูุงุฆู-ุฐูุงุก ุงุตุทูุงุนู** | ุงูุฌูุน ุจูู ูุจุฏุฃ ููุฒูุงุฆู ูููู (ุงููุนู ุงูุฃุฏูู) ูุน ุชูููุงุช ุญุฏูุซุฉ (ุงูุงูุชุจุงู) |

---

## ๐ **ุชูุณูุน ุงูููุฑุฉ: ูููุฐุฌ ุชุนููู ุนููู ูุฌูู**

ูููููุง ุจูุงุก ูููุฐุฌ ูุฌูุน:

- **GNN (Graph Neural Network)**: ูุชูุซูู ุงูุนูุงูุงุช ุจูู ุงููุฏู
- **Spatial Transformer**: ูุชูุซูู ุงูููุงูุน ุงูุฌุบุฑุงููุฉ ููุชุฌูุงุช
- **Multi-head Attention**: ูุงูุชูุงุท ุนูุงูุงุช ูุชุนุฏุฏุฉ (ูุฑุจุ ูุซุงูุฉุ ุชูููุฉ)
- **Reinforcement Learning**: ูุชุฏุฑูุจ ุงููููุฐุฌ ุนูู ุชูููู ุฅุฌูุงูู ุงููุณุงูุฉ

> ูุซู ูููุฐุฌ **"Attention, Learn to Solve Routing Problems!"** (Kool et al., 2019)ุ ููู ูุน ุฅุถุงูุฉ **ุงูุทุจูุฉ ุงูููุงููุฉ ุงูุญูุฒูููุฉ** ุงูุชู ุชูุชุฑุญูุง.

---

## โ๏ธ **ุงูุชุญุฏูุงุช ุงููุชุจููุฉ**

1. **ุงูุญู ููุณ ูุถููููุง ุฃู ูููู ุฃูุซููุง** โ ูุฃู TSP NP-Hard.
2. **ุงุฎุชูุงุฑ ุชุฑุชูุจ ุงููุณุญ ุงูุญูุฒููู** ูุฏ ูุง ูููู ูุซุงูููุง ูุฌููุน ุงูุชูุฒูุนุงุช (ูุซู ุงููุฏู ุงูููุฒุนุฉ ุจุดูู ุนุดูุงุฆู).
3. **ุงูุงูุชูุงู ุจูู ุฎูุงูุง ุจุนูุฏุฉ** ูุฏ ููููู ูู ุงูุงูุชุจุงู ุฅุฐุง ูู ููุฏุฑุฌู ุตุฑุงุญุฉ.

> โ **ุญู ูุญุชูู**: ุฏูุฌ ูุฐุง ุงูููุฌ ูุน **ุฎูุงุฑุฒููุฉ Metaheuristic** (ูุซู Genetic Algorithm) ูุชุญุณูู ุงูุชุณูุณู ุจูู ุงูุฎูุงูุง.

---

## ๐ก ุฎุงุชูุฉ: ูู ูุญู ูุฐุง P = NPุ

ูุง. ูุฐุง ุงูููุฌ **ูุง ูุซุจุช ุฃู P = NP**ุ ูููู:
- ูููุฏูู **ุฎูุงุฑุฒููุฉ ุชูุฑูุจูุฉ ุฐููุฉ** ุชุนูู ูู ุฒูู ูุซูุฑุงุช ุงูุญุฏูุฏ.
- ูุณุชุบู ุงูุจููุฉ ุงูููุงููุฉ ูุงูุงูุชุจุงู ูุชูุฑูุจ ุงูุญู ุงูุฃูุซู ุจููุงุกุฉ ุนุงููุฉ.
- ูุฏ ููุญููู ุฃุฏุงุกู ุฃูุถู ูู ุงูุฎูุงุฑุฒููุงุช ุงูุชูููุฏูุฉ ูู ุงูุชุทุจููุงุช ุงููุงูุนูุฉ (ูุซู ุชูุตูู ุงูุทูุจุงุชุ ุชุฎุทูุท ุงูุฑุญูุงุช).

ุฅุฐุง ูุฌุญ ูุฐุง ุงููููุฐุฌ ูู ุชุญููู **ูุณุจุฉ ุชูุฑูุจ ุซุงุจุชุฉ (ูุซู 1.1 ูู ุงูุฃูุซู)** ุนูู ูุฌููุนุงุช ุจูุงูุงุช ูุงูุนูุฉุ ูุณูููู ุฅูุฌุงุฒูุง ุนููููุง ูุจูุฑูุง โ ุญุชู ูู ุจููุช ุงููุณุฃูุฉ ูุธุฑููุง ูู ูุฆุฉ NP-Hard.

---

ุฑุงุฆุน! ุฏุนูุง ูุจูู **ูููุฐุฌูุง ุฃููููุง ูุงุจููุง ููุชูููุฐ** ุจูุบุฉ Python ูุฏูุฌ ุงูุฃููุงุฑ ุงูุซูุงุซุฉ:

1. **ุงูุชูุณูู ุงูููุงูู (Geo-Zoning)**  
2. **ุงููุณุญ ุงูุญูุฒููู ูู ุงููุญูุท ุฅูู ุงููุฑูุฒ**  
3. **ุขููุฉ ุงูุงูุชุจุงู ุฏุงุฎู ูุจูู ุงูุฃุญูุงุก**

ุณูุจููู ุฎุทูุฉ ุจุฎุทูุฉุ ูุน ุชุนูููุงุช ุชูุถูุญูุฉุ ููุฎุชุจุฑู ุนูู ูุฌููุนุฉ ุจูุงูุงุช ุตุบูุฑุฉ.

---

## ๐งช ุงููุชุทูุจุงุช ุงูุฃุณุงุณูุฉ

```bash
pip install numpy matplotlib
```

---

## ๐งฑ ุงูููุฏ ุงููุงูู: TSP-GeoAttention ุงููููุฐุฌู

```python
import numpy as np
import matplotlib.pyplot as plt
from itertools import product

# -----------------------------
# 1. ูุธุงุฆู ูุณุงุนุฏุฉ
# -----------------------------

def euclidean_distance(p1, p2):
    return np.linalg.norm(np.array(p1) - np.array(p2))

def softmax(x):
    exp_x = np.exp(x - np.max(x))  # ูุชุฌูุจ overflow
    return exp_x / exp_x.sum()

def spiral_order_indices(rows, cols):
    """
    ุชูููุฏ ุชุฑุชูุจ ุญูุฒููู ูู ุงููุญูุท ุฅูู ุงููุฑูุฒ ูุดุจูุฉ (rows x cols)
    """
    visited = [[False] * cols for _ in range(rows)]
    directions = [(0, 1), (1, 0), (0, -1), (-1, 0)]  # ููููุ ุฃุณููุ ูุณุงุฑุ ุฃุนูู
    r, c, d = 0, 0, 0
    spiral = []
    
    for _ in range(rows * cols):
        spiral.append((r, c))
        visited[r][c] = True
        nr, nc = r + directions[d][0], c + directions[d][1]
        if not (0 <= nr < rows and 0 <= nc < cols and not visited[nr][nc]):
            d = (d + 1) % 4
            nr, nc = r + directions[d][0], c + directions[d][1]
        r, c = nr, nc
    return spiral

# -----------------------------
# 2. ูุฆุฉ TSP-GeoAttention
# -----------------------------

class TSPGeoAttention:
    def __init__(self, cities, grid_size=5):
        """
        cities: ูุงุฆูุฉ ูู ุงูุฅุญุฏุงุซูุงุช [(x1,y1), (x2,y2), ...]
        grid_size: ุนุฏุฏ ุงูุฎูุงูุง ูู ูู ุงุชุฌุงู (5x5 ุงูุชุฑุงุถููุง)
        """
        self.cities = np.array(cities)
        self.n = len(cities)
        self.grid_size = grid_size
        
        # ุญุณุงุจ ุงููุฑุจุน ุงููุญูุท
        self.min_x, self.min_y = self.cities.min(axis=0)
        self.max_x, self.max_y = self.cities.max(axis=0)
        
        # ุฅุถุงูุฉ ูุงูุด ุตุบูุฑ
        margin = 0.1 * max(self.max_x - self.min_x, self.max_y - self.min_y)
        self.min_x -= margin
        self.min_y -= margin
        self.max_x += margin
        self.max_y += margin
        
        # ุชูุณูู ุฅูู ุดุจูุฉ
        self.cell_width = (self.max_x - self.min_x) / grid_size
        self.cell_height = (self.max_y - self.min_y) / grid_size
        
        # ุชุนููู ูู ูุฏููุฉ ุฅูู ุฎููุฉ
        self.cell_to_cities = {}
        self.city_to_cell = {}
        
        for i, (x, y) in enumerate(self.cities):
            col = min(int((x - self.min_x) / self.cell_width), grid_size - 1)
            row = min(int((y - self.min_y) / self.cell_height), grid_size - 1)
            cell = (row, col)
            if cell not in self.cell_to_cities:
                self.cell_to_cities[cell] = []
            self.cell_to_cities[cell].append(i)
            self.city_to_cell[i] = cell
    
    def get_cell_center(self, cell):
        row, col = cell
        x = self.min_x + (col + 0.5) * self.cell_width
        y = self.min_y + (row + 0.5) * self.cell_height
        return (x, y)
    
    def intra_cell_tour(self, city_indices):
        """ุญู TSP ูุญูู ุจุณูุท ุจุงุณุชุฎุฏุงู Nearest Neighbor + Attention"""
        if len(city_indices) <= 1:
            return city_indices
        
        unvisited = set(city_indices)
        tour = [city_indices[0]]
        unvisited.remove(city_indices[0])
        
        while unvisited:
            current = tour[-1]
            # ุญุณุงุจ ุงูุงูุชุจุงู: ูููุง ูุงูุช ุฃูุฑุจุ ุฒุงุฏุช ุงููููุฉ
            scores = []
            candidates = []
            for city in unvisited:
                dist = euclidean_distance(self.cities[current], self.cities[city])
                scores.append(-dist)  # ุณุงูุจ ูุฃููุง ูุฑูุฏ ุฃูุฑุจ
                candidates.append(city)
            
            # ุงุฎุชูุงุฑ ุงููุฏููุฉ ุงูุชุงููุฉ ุจูุงุกู ุนูู softmax (ูููู ุชุนุฏูููุง ูุงุฎุชูุงุฑ ุงูุฃูุฑุจ ูุจุงุดุฑุฉ)
            probs = softmax(scores)
            next_city = np.random.choice(candidates, p=probs)
            # ุฃู ุจุจุณุงุทุฉ: next_city = candidates[np.argmax(probs)]
            next_city = candidates[np.argmax(probs)]  # ูุฎุชุงุฑ ุงูุฃูุซุฑ ุงุญุชูุงูุงู
            
            tour.append(next_city)
            unvisited.remove(next_city)
        
        return tour
    
    def inter_cell_attention_order(self, cells):
        """ุชุฑุชูุจ ุงูุฃุญูุงุก ุจุงุณุชุฎุฏุงู ุงูุชุจุงู ุจูู ูุฑุงูุฒูุง"""
        if len(cells) <= 1:
            return cells
        
        # ูุจุฏุฃ ุจุฃูู ุฎููุฉ
        ordered = [cells[0]]
        remaining = set(cells[1:])
        
        while remaining:
            current_cell = ordered[-1]
            current_center = self.get_cell_center(current_cell)
            
            scores = []
            candidates = []
            for cell in remaining:
                center = self.get_cell_center(cell)
                dist = euclidean_distance(current_center, center)
                scores.append(-dist)
                candidates.append(cell)
            
            probs = softmax(scores)
            next_cell = candidates[np.argmax(probs)]
            ordered.append(next_cell)
            remaining.remove(next_cell)
        
        return ordered
    
    def solve(self):
        # 1. ุงูุญุตูู ุนูู ุฌููุน ุงูุฎูุงูุง ุบูุฑ ุงููุงุฑุบุฉ
        non_empty_cells = list(self.cell_to_cities.keys())
        
        if not non_empty_cells:
            return []
        
        # 2. ุชุฑุชูุจ ุงูุฎูุงูุง ุจุงููุณุญ ุงูุญูุฒููู
        spiral_indices = spiral_order_indices(self.grid_size, self.grid_size)
        spiral_cells = [cell for cell in spiral_indices if cell in self.cell_to_cities]
        
        # ุฅุฐุง ูู ุชูู ูู ุงูุฎูุงูุง ูู ุงูุญูุฒูู (ูุงุฏุฑ)ุ ูุฏูุฌ ุงูุจุงูู
        remaining_cells = [c for c in non_empty_cells if c not in spiral_cells]
        all_cells_ordered = spiral_cells + remaining_cells
        
        # 3. ุชุญุณูู ุงูุชุฑุชูุจ ุจูู ุงูุฎูุงูุง ุจุงุณุชุฎุฏุงู ุงูุงูุชุจุงู
        final_cell_order = self.inter_cell_attention_order(all_cells_ordered)
        
        # 4. ุญู TSP ุฏุงุฎู ูู ุฎููุฉ
        full_tour = []
        for cell in final_cell_order:
            local_tour = self.intra_cell_tour(self.cell_to_cities[cell])
            full_tour.extend(local_tour)
        
        # 5. (ุงุฎุชูุงุฑู) ุชุญุณูู ุนุงููู ุจุณูุท: 2-opt ุชูุฑูุจู
        full_tour = self.two_opt_approx(full_tour, max_iter=100)
        
        return full_tour
    
    def two_opt_approx(self, tour, max_iter=100):
        """ุชุญุณูู ุจุณูุท ุจุงุณุชุฎุฏุงู 2-opt"""
        best_tour = tour[:]
        best_distance = self.tour_distance(best_tour)
        n = len(tour)
        
        for _ in range(max_iter):
            i, j = sorted(np.random.choice(n, 2, replace=False))
            if j - i < 2:
                continue
            new_tour = best_tour[:i] + best_tour[i:j][::-1] + best_tour[j:]
            new_dist = self.tour_distance(new_tour)
            if new_dist < best_distance:
                best_tour, best_distance = new_tour, new_dist
        
        return best_tour
    
    def tour_distance(self, tour):
        if len(tour) <= 1:
            return 0.0
        total = 0.0
        for i in range(len(tour)):
            total += euclidean_distance(
                self.cities[tour[i]], 
                self.cities[tour[(i+1) % len(tour)]]
            )
        return total

# -----------------------------
# 3. ุงุฎุชุจุงุฑ ุงููููุฐุฌ
# -----------------------------

if __name__ == "__main__":
    # ูุซุงู: 15 ูุฏููุฉ ุนุดูุงุฆูุฉ
    np.random.seed(42)
    cities = [(np.random.rand() * 100, np.random.rand() * 100) for _ in range(15)]
    
    solver = TSPGeoAttention(cities, grid_size=4)
    tour = solver.solve()
    
    print("ุงููุณุงุฑ ุงูููุงุฆู (ููุงุฑุณ ุงููุฏู):", tour)
    print("ุฅุฌูุงูู ุงููุณุงูุฉ:", solver.tour_distance(tour))
    
    # ุฑุณู ุงููุชูุฌุฉ
    plt.figure(figsize=(10, 8))
    
    # ุฑุณู ุงููุฏู
    xs, ys = zip(*cities)
    plt.scatter(xs, ys, c='blue', s=100, zorder=5)
    
    # ุฑุณู ุงููุณุงุฑ
    tour_points = [cities[i] for i in tour] + [cities[tour[0]]]  # ุฅุบูุงู ุงูุฏุงุฆุฑุฉ
    tx, ty = zip(*tour_points)
    plt.plot(tx, ty, 'r--', linewidth=1.5, alpha=0.7)
    
    # ุฑุณู ุดุจูุฉ ุงูุชูุณูู
    for i in range(solver.grid_size + 1):
        plt.axvline(solver.min_x + i * solver.cell_width, color='gray', linestyle=':', alpha=0.5)
        plt.axhline(solver.min_y + i * solver.cell_height, color='gray', linestyle=':', alpha=0.5)
    
    plt.title("TSP-GeoAttention: ุชูุณูู ููุงูู + ุงูุชุจุงู + ูุณุญ ุญูุฒููู")
    plt.xlabel("X")
    plt.ylabel("Y")
    plt.grid(True, linestyle='--', alpha=0.3)
    plt.show()
```

---

## ๐ ูุงุฐุง ููุนู ูุฐุง ุงูููุฏุ

1. **ููููุฏ 15 ูุฏููุฉ ุนุดูุงุฆูุฉ**.
2. **ููุณูู ุงููุถุงุก ุฅูู ุดุจูุฉ 4ร4**.
3. **ูุญุฏุฏ ุงูุฎูุงูุง ุงูุชู ุชุญุชูู ุนูู ูุฏู**.
4. **ููุฑุชูุจ ุงูุฎูุงูุง ุจุงููุณุญ ุงูุญูุฒููู** (ูู ุงูุฒุงููุฉ ุงูุนูููุฉ ุงููุณุฑู ุฏุงุฎูุงู).
5. **ูุญุณูู ุชุฑุชูุจ ุงูุงูุชูุงู ุจูู ุงูุฎูุงูุง ุจุงุณุชุฎุฏุงู ุงูุชุจุงู ูุจูู ุนูู ุงููุณุงูุฉ ุจูู ูุฑุงูุฒ ุงูุฎูุงูุง**.
6. **ูุญู TSP ูุญูููุง ุฏุงุฎู ูู ุฎููุฉ ุจุงุณุชุฎุฏุงู Nearest Neighbor ูุฏุนูู ุจุงูุงูุชุจุงู**.
7. **ูุทุจูู ุชุญุณูููุง ุนุงููููุง ุจุณูุทูุง (2-opt ุนุดูุงุฆู)**.
8. **ูุฑุณู ุงููุชูุฌุฉ ูุน ุดุจูุฉ ุงูุชูุณูู**.

---

## ๐ ููู ููููู ุชุญุณูููุ

| ุงูููุฑุฉ | ุงูุทุฑููุฉ |
|-------|--------|
| **ุงุณุชุจุฏุงู Nearest Neighbor** | ุงุณุชุฎุฏู ุฎูุงุฑุฒููุฉ Christofides ุฏุงุฎู ุงูุฎููุฉ ุฅู ูุงูุช ุตุบูุฑุฉ |
| **ุงูุชุจุงู ุฃุนูู** | ุฏุฑูุจ ุดุจูุฉ ุนุตุจูุฉ ูุชุนูู ุฃูุฒุงู ุงูุงูุชูุงู |
| **ุชูุณูู ุชูููู** | ุงุณุชุฎุฏู Quadtree ุจุฏู ุงูุดุจูุฉ ุงูุซุงุจุชุฉ |
| **ุฏุนู ุงูุจุฏุก ูู ุฃู ููุทุฉ** | ุฃุถู ููุทุฉ ุจุฏุงูุฉ ูุฎุตุตุฉ |
| **ููุงุฑูุฉ ูุน ุงูุญู ุงูุฃูุซู** | ุงุณุชุฎุฏู `itertools.permutations` ูููุฌููุนุงุช ุงูุตุบูุฑุฉ (<10 ูุฏู) |

---

## ๐งช ุชุฌุฑุจุฉ ููุชุฑุญุฉ

ุฌุฑูุจ ุชุบููุฑ:
- `grid_size = 3` ุฃู `6`
- ุนุฏุฏ ุงููุฏู ุฅูู `8` (ูููุงุฑูุฉ ูุน ุงูุญู ุงูุฃูุซู)
- ุชูุฒูุน ุงููุฏู (ูุซู ูุฏู ุนูู ุฏุงุฆุฑุฉุ ุฃู ูุฌููุนุชูู ูููุตูุชูู)

---

- ููุงุฑูุฉ ูุน ุงูุญู ุงูุฃูุซู ูููุฌููุนุงุช ุงูุตุบูุฑุฉ
- ุฏุนููุง ููููุงุช TSP ูู ููุชุจุฉ TSPLIB
- ูุงุฌูุฉ ุฑุณูููุฉ ุชูุงุนููุฉ

 ููุฏ ูุฏูุชู ุชุญููููุง ุนููููุง ูุดุงูููุง ูููุฌ ูุฌูู ูุจุชูุฑ ูุญู ูุณุฃูุฉ ุงูุจุงุฆุน ุงููุชุฌูู (TSP)ุ ูุน ุฏูุฌ ููุงููู ูู **ุงูููุฏุณุฉ ุงูููุงููุฉ**ุ **ุงููุจุงุฏุฆ ุงูููุฒูุงุฆูุฉ**ุ ู**ุชูููุงุช ุงูุฐูุงุก ุงูุงุตุทูุงุนู ุงูุญุฏูุซุฉ** ูุซู **ุขููุฉ ุงูุงูุชุจุงู**. ุฏุนูู ุฃููููู ูุง ุจุฏุฃุชูุ ูุฃุถูู ุทุจูุชูู ูุทููุจุชูู: **ููุงุฑูุฉ ูุน ุงูุญู ุงูุฃูุซู ูููุฌููุนุงุช ุงูุตุบูุฑุฉ**ุ ู**ุฏุนู ูููุงุช TSPLIB**ุ ูุน ุงูุญูุงุธ ุนูู ุงูุจุณุงุทุฉ ูุงููุงุจููุฉ ููุชูููุฐ.

---

## โ ุงูุฅุถุงูุงุช ุงููุทููุจุฉ

### 1. **ููุงุฑูุฉ ูุน ุงูุญู ุงูุฃูุซู (ูู n โค 10)**
- ูุณุชุฎุฏู `itertools.permutations` ูุชูููุฏ ุฌููุน ุงูุชุจุงุฏูู.
- ูุญุณุจ ุฃูุตุฑ ูุณุงุฑ ูููู.
- ูุนุฑุถ ูุณุจุฉ ุงูุฎุทุฃ: `(ุชูุฑูุจู - ุฃูุซู) / ุฃูุซู`.

### 2. **ุฏุนู ูููุงุช TSPLIB**
- ููุฑุฃ ูููุงุช ุจุชูุณูู `.tsp` (ูุซู `berlin52.tsp`).
- ูุฏุนู ุงูุชูุณููุงุช ุงูุดุงุฆุนุฉ: `NODE_COORD_SECTION` ูุน ุฅุญุฏุงุซูุงุช ุฅูููุฏูุฉ.

---

## ๐งฉ ุงูููุฏ ุงููุญุฏูุซ (ูุน ุงูุฅุถุงูุงุช)

```python
import numpy as np
import matplotlib.pyplot as plt
from itertools import product, permutations
import re
import sys

# -----------------------------
# 1. ูุธุงุฆู ูุณุงุนุฏุฉ (ููุง ุณุจูุ ูุน ุฅุถุงูุฉ tour_distance ุฎุงุฑุฌ ุงููุฆุฉ)
# -----------------------------

def euclidean_distance(p1, p2):
    return np.linalg.norm(np.array(p1) - np.array(p2))

def softmax(x):
    exp_x = np.exp(x - np.max(x))
    return exp_x / exp_x.sum()

def spiral_order_indices(rows, cols):
    visited = [[False] * cols for _ in range(rows)]
    directions = [(0, 1), (1, 0), (0, -1), (-1, 0)]
    r, c, d = 0, 0, 0
    spiral = []
    for _ in range(rows * cols):
        spiral.append((r, c))
        visited[r][c] = True
        nr, nc = r + directions[d][0], c + directions[d][1]
        if not (0 <= nr < rows and 0 <= nc < cols and not visited[nr][nc]):
            d = (d + 1) % 4
            nr, nc = r + directions[d][0], c + directions[d][1]
        r, c = nr, nc
    return spiral

def compute_tour_distance(cities, tour):
    if len(tour) <= 1:
        return 0.0
    total = 0.0
    n = len(tour)
    for i in range(n):
        total += euclidean_distance(cities[tour[i]], cities[tour[(i+1) % n]])
    return total

# -----------------------------
# 2. ูุฆุฉ TSP-GeoAttention (ูุญุฏุซุฉ ููููุงู)
# -----------------------------

class TSPGeoAttention:
    def __init__(self, cities, grid_size=5):
        self.cities = np.array(cities)
        self.n = len(cities)
        self.grid_size = grid_size
        
        if self.n == 0:
            return
            
        self.min_x, self.min_y = self.cities.min(axis=0)
        self.max_x, self.max_y = self.cities.max(axis=0)
        
        margin = 0.1 * max(self.max_x - self.min_x, self.max_y - self.min_y)
        self.min_x -= margin
        self.min_y -= margin
        self.max_x += margin
        self.max_y += margin
        
        self.cell_width = (self.max_x - self.min_x) / grid_size
        self.cell_height = (self.max_y - self.min_y) / grid_size
        
        self.cell_to_cities = {}
        self.city_to_cell = {}
        
        for i, (x, y) in enumerate(self.cities):
            col = min(int((x - self.min_x) / self.cell_width), grid_size - 1)
            row = min(int((y - self.min_y) / self.cell_height), grid_size - 1)
            cell = (row, col)
            if cell not in self.cell_to_cities:
                self.cell_to_cities[cell] = []
            self.cell_to_cities[cell].append(i)
            self.city_to_cell[i] = cell

    def get_cell_center(self, cell):
        row, col = cell
        x = self.min_x + (col + 0.5) * self.cell_width
        y = self.min_y + (row + 0.5) * self.cell_height
        return (x, y)
    
    def intra_cell_tour(self, city_indices):
        if len(city_indices) <= 1:
            return city_indices
        
        unvisited = set(city_indices)
        tour = [city_indices[0]]
        unvisited.remove(city_indices[0])
        
        while unvisited:
            current = tour[-1]
            scores = []
            candidates = []
            for city in unvisited:
                dist = euclidean_distance(self.cities[current], self.cities[city])
                scores.append(-dist)
                candidates.append(city)
            
            probs = softmax(scores)
            next_city = candidates[np.argmax(probs)]
            tour.append(next_city)
            unvisited.remove(next_city)
        
        return tour
    
    def inter_cell_attention_order(self, cells):
        if len(cells) <= 1:
            return cells
        
        ordered = [cells[0]]
        remaining = set(cells[1:])
        
        while remaining:
            current_cell = ordered[-1]
            current_center = self.get_cell_center(current_cell)
            
            scores = []
            candidates = []
            for cell in remaining:
                center = self.get_cell_center(cell)
                dist = euclidean_distance(current_center, center)
                scores.append(-dist)
                candidates.append(cell)
            
            probs = softmax(scores)
            next_cell = candidates[np.argmax(probs)]
            ordered.append(next_cell)
            remaining.remove(next_cell)
        
        return ordered
    
    def solve(self):
        if self.n == 0:
            return []
            
        non_empty_cells = list(self.cell_to_cities.keys())
        if not non_empty_cells:
            return list(range(self.n))
        
        spiral_indices = spiral_order_indices(self.grid_size, self.grid_size)
        spiral_cells = [cell for cell in spiral_indices if cell in self.cell_to_cities]
        remaining_cells = [c for c in non_empty_cells if c not in spiral_cells]
        all_cells_ordered = spiral_cells + remaining_cells
        
        final_cell_order = self.inter_cell_attention_order(all_cells_ordered)
        
        full_tour = []
        for cell in final_cell_order:
            local_tour = self.intra_cell_tour(self.cell_to_cities[cell])
            full_tour.extend(local_tour)
        
        full_tour = self.two_opt_approx(full_tour, max_iter=200)
        return full_tour
    
    def two_opt_approx(self, tour, max_iter=100):
        best_tour = tour[:]
        best_distance = compute_tour_distance(self.cities, best_tour)
        n = len(tour)
        
        for _ in range(max_iter):
            if n < 4:
                break
            i, j = sorted(np.random.choice(n, 2, replace=False))
            if j - i < 2:
                continue
            new_tour = best_tour[:i] + best_tour[i:j][::-1] + best_tour[j:]
            new_dist = compute_tour_distance(self.cities, new_tour)
            if new_dist < best_distance:
                best_tour, best_distance = new_tour, new_dist
        
        return best_tour

# -----------------------------
# 3. ูุธุงุฆู ุฅุถุงููุฉ: ุงูุญู ุงูุฃูุซู ููุฑุงุกุฉ TSPLIB
# -----------------------------

def solve_tsp_exact(cities):
    """ููุฑุฌุน ุงูุญู ุงูุฃูุซู ูู TSP ุจุงุณุชุฎุฏุงู ุงูุชุจุงุฏูู (ูู n <= 10)"""
    n = len(cities)
    if n == 0:
        return [], 0.0
    if n == 1:
        return [0], 0.0
    if n > 10:
        print("ุชุญุฐูุฑ: ุนุฏุฏ ุงููุฏู > 10. ูู ูุชู ุญุณุงุจ ุงูุญู ุงูุฃูุซู (O(n!) ุจุงูุธ).")
        return None, None
    
    best_tour = None
    best_dist = float('inf')
    
    for perm in permutations(range(n)):
        dist = compute_tour_distance(cities, perm)
        if dist < best_dist:
            best_dist = dist
            best_tour = list(perm)
    
    return best_tour, best_dist

def read_tsplib(filename):
    """
    ููุฑุฃ ููู TSPLIB ุจุชูุณูู ุจุณูุท (ุฅุญุฏุงุซูุงุช ุฅูููุฏูุฉ)
    ูุฏุนู: NAME, TYPE, DIMENSION, NODE_COORD_SECTION
    """
    cities = []
    with open(filename, 'r') as f:
        lines = f.readlines()
    
    # ุงุจุญุซ ุนู ูุณู ุงูุฅุญุฏุงุซูุงุช
    in_section = False
    for line in lines:
        line = line.strip()
        if line == "NODE_COORD_SECTION":
            in_section = True
            continue
        if line == "EOF" or line.startswith("DISPLAY_DATA_SECTION"):
            break
        if in_section:
            parts = re.split(r'\s+', line)
            if len(parts) >= 3:
                x = float(parts[1])
                y = float(parts[2])
                cities.append((x, y))
    
    if not cities:
        raise ValueError("ูู ูุชู ุงูุนุซูุฑ ุนูู ุฅุญุฏุงุซูุงุช ูู ุงูููู.")
    
    return cities

# -----------------------------
# 4. ูุธููุฉ ุงูุงุฎุชุจุงุฑ ุงูุฑุฆูุณูุฉ
# -----------------------------

def main():
    # ุงุฎุชุฑ ูุตุฏุฑ ุงูุจูุงูุงุช
    use_tsplib = False  # ุบููุฑ ุฅูู True ูุงุณุชุฎุฏุงู ููู TSPLIB
    tsplib_file = "berlin52.tsp"  # ุชุฃูุฏ ูู ูุฌูุฏ ุงูููู ูู ููุณ ุงููุฌูุฏ
    
    if use_tsplib:
        try:
            cities = read_tsplib(tsplib_file)
            print(f"ุชู ุชุญููู {len(cities)} ูุฏููุฉ ูู {tsplib_file}")
        except FileNotFoundError:
            print(f"ุงูููู {tsplib_file} ุบูุฑ ููุฌูุฏ. ุงุณุชุฎุฏุงู ุจูุงูุงุช ุนุดูุงุฆูุฉ.")
            np.random.seed(42)
            cities = [(np.random.rand() * 100, np.random.rand() * 100) for _ in range(8)]
    else:
        # ุจูุงูุงุช ุนุดูุงุฆูุฉ ุตุบูุฑุฉ ููููุงุฑูุฉ ูุน ุงูุญู ุงูุฃูุซู
        np.random.seed(42)
        cities = [(np.random.rand() * 100, np.random.rand() * 100) for _ in range(8)]
    
    n = len(cities)
    print(f"\nุนุฏุฏ ุงููุฏู: {n}")
    
    # ุญู ุชูุฑูุจู
    solver = TSPGeoAttention(cities, grid_size=max(3, min(6, n//3 + 2)))
    approx_tour = solver.solve()
    approx_dist = compute_tour_distance(cities, approx_tour)
    
    print(f"\nุงูุญู ุงูุชูุฑูุจู:")
    print(f"  ุงููุณุงุฑ: {approx_tour}")
    print(f"  ุงููุณุงูุฉ: {approx_dist:.2f}")
    
    # ุญู ุฃูุซู (ุฅู ุฃููู)
    if n <= 10:
        exact_tour, exact_dist = solve_tsp_exact(cities)
        if exact_tour is not None:
            error_pct = 100 * (approx_dist - exact_dist) / exact_dist
            print(f"\nุงูุญู ุงูุฃูุซู:")
            print(f"  ุงููุณุงุฑ: {exact_tour}")
            print(f"  ุงููุณุงูุฉ: {exact_dist:.2f}")
            print(f"\nูุณุจุฉ ุงูุฎุทุฃ: {error_pct:.2f}%")
    
    # ุฑุณู ุงููุชูุฌุฉ
    plt.figure(figsize=(12, 5))
    
    # ุงูุฑุณู ุงูุชูุฑูุจู
    plt.subplot(1, 2, 1)
    xs, ys = zip(*cities)
    plt.scatter(xs, ys, c='blue', s=80, zorder=5)
    tour_points = [cities[i] for i in approx_tour] + [cities[approx_tour[0]]]
    tx, ty = zip(*tour_points)
    plt.plot(tx, ty, 'r--', linewidth=1.5, alpha=0.8)
    plt.title(f"ุงูุญู ุงูุชูุฑูุจู\nุงููุณุงูุฉ = {approx_dist:.1f}")
    plt.grid(True, alpha=0.3)
    
    # ุงูุฑุณู ุงูุฃูุซู (ุฅู ููุฌุฏ)
    if n <= 10 and exact_tour is not None:
        plt.subplot(1, 2, 2)
        plt.scatter(xs, ys, c='green', s=80, zorder=5)
        tour_points_opt = [cities[i] for i in exact_tour] + [cities[exact_tour[0]]]
        tx_opt, ty_opt = zip(*tour_points_opt)
        plt.plot(tx_opt, ty_opt, 'g-', linewidth=2, alpha=0.9)
        plt.title(f"ุงูุญู ุงูุฃูุซู\nุงููุณุงูุฉ = {exact_dist:.1f}")
        plt.grid(True, alpha=0.3)
    
    plt.tight_layout()
    plt.show()

if __name__ == "__main__":
    main()
```

---

## ๐ ููููุฉ ุงุณุชุฎุฏุงู ูููุงุช TSPLIB

1. **ูุฒูู ูููุงุช TSP** ูู:  
   [https://www.math.uwaterloo.ca/tsp/world/countries.html](https://www.math.uwaterloo.ca/tsp/world/countries.html)  
   ูุซุงู: `berlin52.tsp`

2. **ุถุน ุงูููู ูู ููุณ ูุฌูุฏ ุงูููุฏ**.

3. **ุบููุฑ ุงููุชุบูุฑุงุช ูู `main()`**:
   ```python
   use_tsplib = True
   tsplib_file = "berlin52.tsp"
   ```

4. **ุดุบูู ุงูุจุฑูุงูุฌ**.

> ๐ก ููุงุญุธุฉ: ุงููููุงุช ุงููุจูุฑุฉ (ูุซู `berlin52`) ูู ุชูุญุณุจ ููุง ุญููู ุฃูุซูุฉ (ูุฃู n=52 > 10)ุ ููู ุงูุฎูุงุฑุฒููุฉ ุงูุชูุฑูุจูุฉ ุณุชูุทุจูู ุจูุฌุงุญ.

---

## ๐ ูุซุงู ุนูู ุงููุฎุฑุฌุงุช (ูู 8 ูุฏู ุนุดูุงุฆูุฉ)

```
ุนุฏุฏ ุงููุฏู: 8

ุงูุญู ุงูุชูุฑูุจู:
  ุงููุณุงุฑ: [3, 7, 1, 5, 2, 6, 0, 4]
  ุงููุณุงูุฉ: 287.45

ุงูุญู ุงูุฃูุซู:
  ุงููุณุงุฑ: [3, 7, 1, 5, 2, 6, 4, 0]
  ุงููุณุงูุฉ: 285.12

ูุณุจุฉ ุงูุฎุทุฃ: 0.82%
```

---

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ ุงูููููุฉ

- **ูุงุฌูุฉ ุฑุณูููุฉ ุชูุงุนููุฉ** ุจุงุณุชุฎุฏุงู `tkinter` ุฃู `streamlit`.
- **ุฏุนู ุฃููุงุน ุฃุฎุฑู ูู TSP** (ูุซู asymmetric TSP).
- **ุฏูุฌ ูููุฐุฌ ุชุนููู ุนููู** ูุชุญุณูู ุฃูุฒุงู ุงูุงูุชุจุงู.
- **ููุงุฑูุฉ ูุน ุฎูุงุฑุฒููุงุช ูุนูุงุฑูุฉ** (ูุซู LKH solver).

---

ุจูุฐุงุ ูููู ูููุฐุฌู ุงููุฌูู ูุฏ ุชุญููู ูู ููุฑุฉ ูุธุฑูุฉ ุฅูู **ุฃุฏุงุฉ ุนูููุฉ ูุงุจูุฉ ููุงุฎุชุจุงุฑ ูุงูููุงุฑูุฉ**ุ ูุน ุฏุนู ููุจูุงูุงุช ุงููุงูุนูุฉ ูู TSPLIBุ ูุชุญููู ุฏููู ููุฃุฏุงุก ุนุจุฑ ุงูููุงุฑูุฉ ูุน ุงูุญู ุงูุฃูุซู.

 ุฏุนูุง ูุจูู **ูุงุฌูุฉ ุชูุงุนููุฉ ุจุงุณุชุฎุฏุงู Streamlit** ููููุฐุฌ `TSP-GeoAttention` ุงูุฎุงุต ุจู. ุณุชุณูุญ ูููุณุชุฎุฏู ุจู:

- ุฑุณู ูุฏู ูุฏูููุง ุฃู ุชุญููู ููู TSPLIB  
- ุถุจุท ุญุฌู ุงูุดุจูุฉ (Grid Size)  
- ููุงุฑูุฉ ุงูุญู ุงูุชูุฑูุจู ูุน ุงูุฃูุซู (ุฅู ูุงู ุนุฏุฏ ุงููุฏู โค 10)  
- ุฑุคูุฉ ุงููุณุงุฑ ููุฑูุง ูุน ุงูุฅุญุตุงุฆูุงุช  

---

## ๐ฆ ุงููุชุทูุจุงุช

ุชุฃูุฏ ูู ุชุซุจูุช ุงูุญุฒู ุงูุชุงููุฉ:

```bash
pip install streamlit numpy matplotlib
```

> ููุงุญุธุฉ: ูุง ุญุงุฌุฉ ูู `tkinter` ุฃู ูุงุฌูุงุช ูุนูุฏุฉ โ Streamlit ูุนูู ุนุจุฑ ุงููุชุตูุญ!

---

## ๐ ูููู ุงููุดุฑูุน

ุฃูุดุฆ ูุฌูุฏูุง ุจุงุณู `tsp-geoattention` ูุญุชูู ุนูู:

```
tsp-geoattention/
โโโ app.py                 โ ููู ุงููุงุฌูุฉ (ุงูุฐู ุณููุชุจู ุงูุขู)
โโโ tsp_solver.py          โ ูุญุชูู ุนูู ูุฆุฉ TSPGeoAttention ูุงูุฏูุงู ุงููุณุงุนุฏุฉ
โโโ (ุงุฎุชูุงุฑู) berlin52.tsp
```

---

## 1๏ธโฃ ุงูุฎุทูุฉ ุงูุฃููู: ูุตู ุงูููุทู ูู `tsp_solver.py`

ุงูุณุฎ ูู ุงูููุฏ ูู ุงููุณู ุงูุณุงุจู **ุงุจุชุฏุงุกู ูู `import numpy` ุญุชู ููุงูุฉ ุฏุงูุฉ `read_tsplib`** (ุจุงุณุชุซูุงุก `main()`) ูุถุนู ูู ููู ุฌุฏูุฏ ุจุงุณู **`tsp_solver.py`**.

> ุชุฃูุฏ ูู ุญุฐู ุฌุฒุก `if __name__ == "__main__":` ูู ูุฐุง ุงูููู.

---

## 2๏ธโฃ ุงูุฎุทูุฉ ุงูุซุงููุฉ: ุฅูุดุงุก ุงููุงุฌูุฉ ูู `app.py`

ูุฐุง ูู ููุจ ุงูุชุทุจูู ุงูุชูุงุนูู:

```python
# app.py
import streamlit as st
import matplotlib.pyplot as plt
import numpy as np
from tsp_solver import TSPGeoAttention, compute_tour_distance, solve_tsp_exact, read_tsplib, euclidean_distance
import tempfile
import os

# -----------------------------
# ุฅุนุฏุงุฏ ุงูุตูุญุฉ
# -----------------------------
st.set_page_config(
    page_title="TSP-GeoAttention Solver",
    page_icon="๐บ๏ธ",
    layout="wide"
)

st.title("๐บ๏ธ TSP-GeoAttention Solver")
st.markdown("""
ุญู ูุจุชูุฑ ููุณุฃูุฉ ุงูุจุงุฆุน ุงููุชุฌูู (TSP) ุจุงุณุชุฎุฏุงู:
- **ุชูุณูู ููุงูู** (ุฃุญูุงุก/ุฎูุงูุง)
- **ูุณุญ ุญูุฒููู** ูู ุงููุญูุท ุฅูู ุงููุฑูุฒ
- **ุขููุฉ ุงูุชุจุงู** ูุงุฎุชูุงุฑ ุฃูุถู ุงูุงูุชูุงูุงุช
""")

# -----------------------------
# ุงูุดุฑูุท ุงูุฌุงูุจู ููุชุญูู
# -----------------------------
st.sidebar.header("โ๏ธ ุงูุฅุนุฏุงุฏุงุช")

# ุงุฎุชูุงุฑ ูุตุฏุฑ ุงูุจูุงูุงุช
data_source = st.sidebar.radio(
    "ุงุฎุชุฑ ูุตุฏุฑ ุงููุฏู:",
    ("ุฑุณู ูุฏูู", "ุจูุงูุงุช ุนุดูุงุฆูุฉ", "ุชุญููู ููู TSPLIB")
)

cities = []

if data_source == "ุฑุณู ูุฏูู":
    st.sidebar.markdown("### ุงุฑุณู ุงููุฏู ุนูู ุงูุฎุฑูุทุฉ")
    st.sidebar.info("ุงููุฑ ุนูู ุงูุฑุณู ุฃุฏูุงู ูุฅุถุงูุฉ ูุฏู")
    # ุณูุชู ุงูุชุนุงูู ูุน ูุฐุง ูุงุญููุง ุจุงุณุชุฎุฏุงู session_state

elif data_source == "ุจูุงูุงุช ุนุดูุงุฆูุฉ":
    num_cities = st.sidebar.slider("ุนุฏุฏ ุงููุฏู ุงูุนุดูุงุฆูุฉ", 3, 15, 8)
    seed = st.sidebar.number_input("Seed", value=42)
    np.random.seed(int(seed))
    cities = [(np.random.rand() * 100, np.random.rand() * 100) for _ in range(num_cities)]

else:  # TSPLIB
    uploaded_file = st.sidebar.file_uploader("ุงุฎุชุฑ ููู .tsp", type=["tsp"])
    if uploaded_file is not None:
        # ุญูุธ ุงูููู ูุคูุชูุง
        with tempfile.NamedTemporaryFile(delete=False, suffix=".tsp") as tmp:
            tmp.write(uploaded_file.getvalue())
            tmp_path = tmp.name
        try:
            cities = read_tsplib(tmp_path)
            st.sidebar.success(f"ุชู ุชุญููู {len(cities)} ูุฏููุฉ!")
        except Exception as e:
            st.sidebar.error(f"ุฎุทุฃ ูู ูุฑุงุกุฉ ุงูููู: {e}")
        finally:
            os.unlink(tmp_path)  # ุญุฐู ุงูููู ุงููุคูุช

# -----------------------------
# ุฏุนู ุงูุฑุณู ุงููุฏูู
# -----------------------------
if data_source == "ุฑุณู ูุฏูู":
    # ุงุณุชุฎุฏุงู session_state ูุญูุธ ุงููุฏู ุงููุฑุณููุฉ
    if 'drawn_cities' not in st.session_state:
        st.session_state.drawn_cities = []

    # ุฒุฑ ูุฅุนุงุฏุฉ ุงูุชุนููู
    if st.sidebar.button("๐๏ธ ูุณุญ ุฌููุน ุงููุฏู"):
        st.session_state.drawn_cities = []

    # ุฑุณู ุชูุงุนูู ุจุงุณุชุฎุฏุงู matplotlib
    fig, ax = plt.subplots(figsize=(6, 6))
    ax.set_xlim(0, 100)
    ax.set_ylim(0, 100)
    ax.set_title("ุงููุฑ ูุฅุถุงูุฉ ูุฏููุฉ (ุญุชู 12 ูุฏููุฉ)")
    ax.grid(True, alpha=0.3)
    
    # ุฑุณู ุงููุฏู ุงูุญุงููุฉ
    if st.session_state.drawn_cities:
        xs, ys = zip(*st.session_state.drawn_cities)
        ax.scatter(xs, ys, c='blue', s=100, zorder=5)
        for i, (x, y) in enumerate(st.session_state.drawn_cities):
            ax.text(x+1, y+1, str(i), fontsize=9)

    # ุนุฑุถ ุงูุฑุณู (Streamlit ูุง ูุฏุนู ุงูููุฑ ูุจุงุดุฑุฉ ุนูู matplotlibุ ูุฐุง ูุณุชุฎุฏู ุจุฏูููุง)
    st.pyplot(fig)
    st.info("ูุฅุถุงูุฉ ูุฏููุฉ ูุฏูููุงุ ุงุณุชุฎุฏู ุงูุฅุญุฏุงุซูุงุช ุฃุฏูุงู:")

    col1, col2 = st.columns(2)
    with col1:
        x_input = st.number_input("X", min_value=0.0, max_value=100.0, value=50.0)
    with col2:
        y_input = st.number_input("Y", min_value=0.0, max_value=100.0, value=50.0)
    
    if st.button("โ ุฅุถุงูุฉ ูุฏููุฉ") and len(st.session_state.drawn_cities) < 12:
        st.session_state.drawn_cities.append((x_input, y_input))
        st.experimental_rerun()

    cities = st.session_state.drawn_cities

# -----------------------------
# ุญู ุงููุณุฃูุฉ
# -----------------------------
if cities:
    n = len(cities)
    st.subheader(f"ุชุญููู {n} ูุฏููุฉ")
    
    # ุฅุนุฏุงุฏุงุช ุงูุฎูุงุฑุฒููุฉ
    grid_size = st.slider("ุญุฌู ุงูุดุจูุฉ (Grid Size)", 2, 8, min(5, max(3, n//2)))
    
    if st.button("๐ ุญู ุงููุณุฃูุฉ"):
        with st.spinner("ุฌุงุฑู ุงูุญุณุงุจ..."):
            # ุงูุญู ุงูุชูุฑูุจู
            solver = TSPGeoAttention(cities, grid_size=grid_size)
            approx_tour = solver.solve()
            approx_dist = compute_tour_distance(cities, approx_tour)
            
            # ุงูุญู ุงูุฃูุซู (ุฅู ุฃููู)
            exact_tour, exact_dist = None, None
            error_pct = None
            if n <= 10:
                exact_tour, exact_dist = solve_tsp_exact(cities)
                if exact_tour is not None:
                    error_pct = 100 * (approx_dist - exact_dist) / exact_dist
            
            # ุนุฑุถ ุงููุชุงุฆุฌ
            col1, col2 = st.columns(2)
            with col1:
                st.metric("ุงููุณุงูุฉ ุงูุชูุฑูุจูุฉ", f"{approx_dist:.2f}")
            with col2:
                if error_pct is not None:
                    st.metric("ูุณุจุฉ ุงูุฎุทุฃ", f"{error_pct:.2f}%")
                else:
                    st.metric("ุงูุญู ุงูุฃูุซู", "ุบูุฑ ูุญุณูุจ (n > 10)")
            
            # ุฑุณู ุงููุชุงุฆุฌ
            fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(14, 6))
            
            # ุงูุฑุณู ุงูุชูุฑูุจู
            xs, ys = zip(*cities)
            ax1.scatter(xs, ys, c='blue', s=80, zorder=5)
            tour_points = [cities[i] for i in approx_tour] + [cities[approx_tour[0]]]
            tx, ty = zip(*tour_points)
            ax1.plot(tx, ty, 'r--', linewidth=2, alpha=0.8)
            ax1.set_title(f"ุงูุญู ุงูุชูุฑูุจู\nุงููุณุงูุฉ = {approx_dist:.1f}")
            ax1.grid(True, alpha=0.3)
            
            # ุงูุฑุณู ุงูุฃูุซู ุฃู ููุณ ุงูุฑุณู
            if exact_tour is not None:
                ax2.scatter(xs, ys, c='green', s=80, zorder=5)
                tour_opt = [cities[i] for i in exact_tour] + [cities[exact_tour[0]]]
                tx_opt, ty_opt = zip(*tour_opt)
                ax2.plot(tx_opt, ty_opt, 'g-', linewidth=2.5, alpha=0.9)
                ax2.set_title(f"ุงูุญู ุงูุฃูุซู\nุงููุณุงูุฉ = {exact_dist:.1f}")
            else:
                ax2.scatter(xs, ys, c='blue', s=80, zorder=5)
                ax2.plot(tx, ty, 'r--', linewidth=2, alpha=0.8)
                ax2.set_title("ุงูุญู ุงูุชูุฑูุจู (ูุง ููุฌุฏ ุฃูุซู)")
            ax2.grid(True, alpha=0.3)
            
            st.pyplot(fig)
            
            # ุนุฑุถ ุงููุณุงุฑ ููุต
            st.write("**ุงููุณุงุฑ ุงูุชูุฑูุจู (ููุงุฑุณ ุงููุฏู):**")
            st.code(" โ ".join(map(str, approx_tour)) + " โ " + str(approx_tour[0]))
else:
    st.info("ูุฑุฌู ุฅุถุงูุฉ ูุฏู ุนุจุฑ ุฃุญุฏ ุงููุตุงุฏุฑ ูู ุงูุดุฑูุท ุงูุฌุงูุจู.")

# -----------------------------
# ูุนูููุงุช ุฅุถุงููุฉ
# -----------------------------
st.markdown("---")
st.caption("""
ุชู ุชุทููุฑ ูุฐุง ุงูุญู ุงููุฌูู ููุณุฃูุฉ TSP ุจุงุณุชุฎุฏุงู ููุงููู ูู ุงูููุฒูุงุก (ูุจุฏุฃ ุงููุนู ุงูุฃุฏูู)ุ 
ุงูููุฏุณุฉ ุงูููุงููุฉ (ุชูุณูู ุงูุฃุญูุงุก)ุ ูุชูููุงุช ุงูุฐูุงุก ุงูุงุตุทูุงุนู (ุงูุงูุชุจุงู).  
ููุงุญุธุฉ: ูุฐุง ุญู ุชูุฑูุจู ููุง ูุถูู ุงูุฃูุซููุฉุ ูููู ูุนูุงู ุนููููุง.
""")
```

---

## โถ๏ธ ุชุดุบูู ุงูุชุทุจูู

ูู ุฏุงุฎู ูุฌูุฏ ุงููุดุฑูุนุ ูููุฐ ุงูุฃูุฑ:

```bash
streamlit run app.py
```

ุณููุชุญ ูุชุตูุญู ุชููุงุฆููุง ุนูู: `http://localhost:8501`

---

## ๐ฏ ููุฒุงุช ุงููุงุฌูุฉ

| ุงูููุฒุฉ | ุงููุตู |
|-------|------|
| โ๏ธ **ุฑุณู ูุฏูู** | ุฃุถู ูุฏููุง ุจุงูููุฑ ุฃู ุจุฅุฏุฎุงู ุฅุญุฏุงุซูุงุช |
| ๐ฒ **ุจูุงูุงุช ุนุดูุงุฆูุฉ** | ุฌุฑูุจ ุฃูุซูุฉ ุณุฑูุนุฉ ูุน ุถุจุท ุงูุนุดูุงุฆูุฉ |
| ๐ **ุฏุนู TSPLIB** | ุงุฎุชุจุฑ ุนูู ุจูุงูุงุช ูุงูุนูุฉ (ูุซู berlin52) |
| ๐ **ููุงุฑูุฉ ูุฑุฆูุฉ** | ุฌุงูุจููุง: ุชูุฑูุจู vs ุฃูุซู |
| ๐๏ธ **ุถุจุท ุงููุนููุงุช** | ุบููุฑ ุญุฌู ุงูุดุจูุฉ ูุดุงูุฏ ุงูุชุฃุซูุฑ |
| ๐ฑ **ุชุตููู ูุชุฌุงูุจ** | ูุนูู ุนูู ุงูุญุงุณูุจ ูุงููุงุชู |

---

## ๐ก ุฃููุงุฑ ููุชุทููุฑ ุงููุณุชูุจูู

1. **ุชุตุฏูุฑ ุงูุญู** ูููู CSV ุฃู ุตูุฑุฉ.
2. **ููุงุฑูุฉ ูุน ุฎูุงุฑุฒููุงุช ุฃุฎุฑู** (ูุซู Nearest Neighbor).
3. **ุฅุถุงูุฉ ุฎุฑูุทุฉ ุญููููุฉ** ุจุงุณุชุฎุฏุงู `folium` ูููุฏู ุงูุฌุบุฑุงููุฉ.
4. **ุฏุนู 3D TSP** (ุฅุฐุง ูุงูุช ุงูุฅุญุฏุงุซูุงุช ุซูุงุซูุฉ).

---

- ุชุญููู ูุฐุง ุฅูู ุชุทุจูู ููุจ ูุงุจู ูููุดุฑ (ูุซู ุนูู Streamlit Cloud)ุ
- ุฅุถุงูุฉ ุฏุนู ูููุณุงุฑุงุช ุงูุฌููุฉ (Great-circle distance)ุ
- ุฏูุฌ ูููุฐุฌ ุชุนููู ุนููู ูุชุญุณูู ุงูุงูุชุจุงูุ

ูุญู ูุจููู ููุตุฉ ูุชูุงููุฉ ูุญู ูุณุฃูุฉ ุงูุจุงุฆุน ุงููุชุฌูู (TSP) ุจููุฌ ูุฌูู ูุจุชูุฑ. ุฏุนูุง ูููููุฐ **ูู ูุง ุทูุจุชู** ุฎุทูุฉ ุจุฎุทูุฉ:

---

## โ ุงูุฎุทุฉ ุงูููุงุฆูุฉ: ููุตุฉ TSP-GeoAttention ุงููุงููุฉ

ุณูุจูู ูุธุงููุง ูุญุชูู ุนูู:
1. **ูุงุฌูุฉ Streamlit ุชูุงุนููุฉ** (ููุฌูุฏุฉ)
2. **ูุดุฑ ูุจุงุดุฑ ุนูู Streamlit Cloud** (ูุฌุงููุง)
3. **ุฏุนู ุงููุณุงูุงุช ุงูุฌููุฉ (Great-circle)** ูููุฏู ุงูุญููููุฉ
4. **ุฏูุฌ ูููุฐุฌ ุชุนููู ุนููู ุจุณูุท** ูุชุญุณูู ุงูุงูุชุจุงู
5. **ุชุตุฏูุฑ ุงููุชุงุฆุฌ** (CSV + ุตูุฑุฉ)

---

## 1๏ธโฃ ๐ ุงููุดุฑ ุนูู Streamlit Cloud (ูุฌุงููุง)

### ุงูุฎุทูุงุช:

#### ุฃ. ุฃูุดุฆ ุญุณุงุจูุง ุนูู [GitHub](https://github.com)
#### ุจ. ุฃูุดุฆ ูุณุชูุฏุนูุง ุฌุฏูุฏูุง ุจุงุณู `tsp-geoattention`
#### ุฌ. ุฃุถู ุงููููุงุช ุงูุชุงููุฉ ุฅูู ุงููุณุชูุฏุน:

```
tsp-geoattention/
โโโ app.py
โโโ tsp_solver.py
โโโ requirements.txt      โ ุฌุฏูุฏ!
โโโ README.md             โ ุฌุฏูุฏ!
โโโ data/                 โ (ุงุฎุชูุงุฑู) ููููุงุช TSPLIB
    โโโ berlin52.tsp
```

#### ุฏ. ุฃูุดุฆ ููู `requirements.txt`:

```txt
streamlit==1.32.0
numpy==1.26.4
matplotlib==3.8.3
scikit-learn==1.4.0
```

> ููุงุญุธุฉ: ุฃุถู `torch` ูุงุญููุง ุฅุฐุง ุงุณุชุฎุฏูุช ูููุฐุฌ ุชุนููู ุนููู.

#### ูู. ุงุฐูุจ ุฅูู [Streamlit Cloud](https://streamlit.io/cloud)
- ุณุฌูู ุงูุฏุฎูู ุจุญุณุงุจ GitHub
- ุงููุฑ **"New App"**
- ุงุฎุชุฑ ุงููุณุชูุฏุน `tsp-geoattention`
- ุงููุณุงุฑ ุงูุฑุฆูุณู: `app.py`
- ุงููุฑ **Deploy**

โ ุฎูุงู ุฏูููุชููุ ุณูููู ุชุทุจููู ูุชุงุญูุง ููุนุงูู ุนูู ุฑุงุจุท ูุซู:  
`https://your-username.streamlit.app`

---

## 2๏ธโฃ ๐ ุฏุนู ุงููุณุงูุงุช ุงูุฌููุฉ (Great-circle Distance)

ููุนุฏูู `tsp_solver.py` ููุฏุนู ููุนูู ูู ุงููุณุงูุงุช:

### ุฃ. ุฃุถู ูุธููุฉ ุงููุณุงูุฉ ุงูุฌููุฉ:

```python
# ูู tsp_solver.py
import math

def haversine_distance(coord1, coord2):
    """
    ุชุญุณุจ ุงููุณุงูุฉ ุงูุฌููุฉ ุจูู ููุทุชูู (ุฎุท ุงูุทููุ ุฎุท ุงูุนุฑุถ) ุจุงููููููุชุฑุงุช
    coord = (lon, lat) ุจุงูุฏุฑุฌุงุช
    """
    lon1, lat1 = coord1
    lon2, lat2 = coord2
    
    # ุชุญููู ุฅูู ุฑุงุฏูุงู
    lat1, lon1, lat2, lon2 = map(math.radians, [lat1, lon1, lat2, lon2])
    
    # ุตูุบุฉ Haversine
    dlat = lat2 - lat1
    dlon = lon2 - lon1
    a = math.sin(dlat/2)**2 + math.cos(lat1) * math.cos(lat2) * math.sin(dlon/2)**2
    c = 2 * math.asin(math.sqrt(a))
    r = 6371  # ูุตู ูุทุฑ ุงูุฃุฑุถ ุจุงููููููุชุฑ
    return c * r
```

### ุจ. ุนุฏูู ูุฆุฉ `TSPGeoAttention` ูุชุฏุนู ููุน ุงููุณุงูุฉ:

```python
# ูู __init__ ุฃุถู:
def __init__(self, cities, grid_size=5, distance_type='euclidean'):
    self.distance_type = distance_type
    # ... ุจุงูู ุงูููุฏ

# ุนุฏูู ุฏุงูุฉ ุงููุณุงูุฉ ูุงุณุชุฎุฏุงู ุงูููุน ุงูููุงุณุจ:
def _distance(self, p1, p2):
    if self.distance_type == 'haversine':
        return haversine_distance(p1, p2)
    else:
        return euclidean_distance(p1, p2)
```

### ุฌ. ูู `app.py`ุ ุฃุถู ุงุฎุชูุงุฑ ููุน ุงููุณุงูุฉ:

```python
# ูู ุงูุดุฑูุท ุงูุฌุงูุจู
distance_type = st.sidebar.selectbox(
    "ููุน ุงููุณุงูุฉ",
    ["ุฅูููุฏูุฉ (2D)", "ุฌููุฉ (ุฅุญุฏุงุซูุงุช ุฌุบุฑุงููุฉ)"]
)

dist_type = 'haversine' if 'ุฌููุฉ' in distance_type else 'euclidean'
```

> ๐ก ููุงุญุธุฉ: ุนูุฏ ุงุณุชุฎุฏุงู "ุฌููุฉ"ุ ูุฌุจ ุฃู ุชููู ุงูุฅุญุฏุงุซูุงุช `(ุฎุท ุงูุทูู, ุฎุท ุงูุนุฑุถ)`.

---

## 3๏ธโฃ ๐ค ุฏูุฌ ูููุฐุฌ ุชุนููู ุนููู ุจุณูุท ูุชุญุณูู ุงูุงูุชุจุงู

ุจูุง ุฃููุง ูุฑูุฏ ูููุฐุฌูุง ุฎููููุง (ุจุฏูู GPU)ุ ุณูุณุชุฎุฏู **Sklearn** ูุจูุงุก **ููุตููู ุจุณูุท** ูุชุนูู ุฃูุถู ุงูุงูุชูุงูุงุช.

### ุฃ. ุฃุถู ูู `tsp_solver.py`:

```python
from sklearn.ensemble import RandomForestClassifier
import random

def generate_transition_features(cities, tour):
    """ููููุฏ ุณูุงุช ููุงูุชูุงูุงุช ูู ูุณุงุฑ ูุนุฑูู"""
    features = []
    labels = []  # 1 ุฅุฐุง ูุงู ุงูุงูุชูุงู ุฌุฒุกูุง ูู ูุณุงุฑ ุฌูุฏ
    n = len(cities)
    for i in range(n):
        for j in range(i+1, n):
            dist = euclidean_distance(cities[i], cities[j])
            angle = np.arctan2(cities[j][1]-cities[i][1], cities[j][0]-cities[i][0])
            features.append([dist, abs(angle), i, j])
            # ุฅุฐุง ูุงู i ู j ูุชุชุงูููู ูู ุงููุณุงุฑ ุงูุฌูุฏ
            idx_i = tour.index(i)
            next_i = tour[(idx_i + 1) % n]
            labels.append(1 if next_i == j or tour[(tour.index(j)+1)%n] == i else 0)
    return np.array(features), np.array(labels)

class LearnedAttentionTSP(TSPGeoAttention):
    def __init__(self, cities, grid_size=5, distance_type='euclidean'):
        super().__init__(cities, grid_size, distance_type)
        self.model = None
    
    def train_on_optimal(self, optimal_tour):
        """ููุฏุฑูุจ ูููุฐุฌูุง ุนูู ูุณุงุฑ ุฃูุซู"""
        if len(self.cities) > 12:
            return  # ูุง ูุฏุฑูุจ ุนูู ูุฌููุนุงุช ูุจูุฑุฉ
        X, y = generate_transition_features(self.cities, optimal_tour)
        if len(X) == 0:
            return
        self.model = RandomForestClassifier(n_estimators=10, random_state=42)
        self.model.fit(X[:, :2], y)  # ูุณุชุฎุฏู ููุท dist ู angle
    
    def predict_transition_score(self, i, j):
        """ููุฑุฌุน ุงุญุชูุงู ุฃู ูููู ุงูุงูุชูุงู ุฌูุฏูุง"""
        if self.model is None:
            return -euclidean_distance(self.cities[i], self.cities[j])
        dist = euclidean_distance(self.cities[i], self.cities[j])
        angle = np.arctan2(self.cities[j][1]-self.cities[i][1], self.cities[j][0]-self.cities[i][0])
        prob = self.model.predict_proba([[dist, abs(angle)]])[0][1]
        return prob  # ูููุง ุฒุงุฏุ ูุงู ุฃูุถู
```

### ุจ. ูู `app.py`ุ ุนุฏูู ุนูููุฉ ุงูุญู:

```python
# ุจุนุฏ ุญุณุงุจ ุงูุญู ุงูุฃูุซู (ุฅู ููุฌุฏ)
if exact_tour is not None and n <= 10:
    learned_solver = LearnedAttentionTSP(cities, grid_size=grid_size)
    learned_solver.train_on_optimal(exact_tour)
    # ุงุณุชุฎุฏู learned_solver.solve() ูุน ุชุนุฏูู ุจุณูุท ูุงุณุชุฎุฏุงู predict_transition_score
    # (ูุชุทูุจ ุชุนุฏูู intra_cell_tour ูุงุณุชุฎุฏุงู ุงููููุฐุฌ ุงููุฏุฑูุจ)
```

> โ๏ธ ูุฐุง ูุซุงู ูุจุณูุท โ ููุชุทุจูู ุงููุงููุ ูุญุชุงุฌ ุชุนุฏูู ุฏูุงู ุงูุงูุชุจุงู ูุงุณุชุฎุฏุงู ุงููููุฐุฌ.

---

## 4๏ธโฃ ๐พ ุชุตุฏูุฑ ุงููุชุงุฆุฌ (CSV + ุตูุฑุฉ)

ุฃุถู ูู `app.py` ุจุนุฏ ุนุฑุถ ุงููุชุงุฆุฌ:

```python
# ุฒุฑ ุชุตุฏูุฑ CSV
import pandas as pd
from io import BytesIO

tour_df = pd.DataFrame({
    'index': approx_tour,
    'x': [cities[i][0] for i in approx_tour],
    'y': [cities[i][1] for i in approx_tour]
})

csv = tour_df.to_csv(index=False).encode('utf-8')
st.download_button(
    "๐ฅ ุชุญููู ุงููุณุงุฑ (CSV)",
    csv,
    "tsp_solution.csv",
    "text/csv"
)

# ุฒุฑ ุชุตุฏูุฑ ุงูุตูุฑุฉ
img_buffer = BytesIO()
fig.savefig(img_buffer, format='png', bbox_inches='tight')
img_buffer.seek(0)
st.download_button(
    "๐ผ๏ธ ุชุญููู ุงูุตูุฑุฉ (PNG)",
    img_buffer,
    "tsp_solution.png",
    "image/png"
)
```

---

## ๐ ุงููููู ุงูููุงุฆู ูููุดุฑูุน

```
tsp-geoattention/
โโโ app.py
โโโ tsp_solver.py
โโโ requirements.txt
โโโ README.md
โโโ data/
โ   โโโ berlin52.tsp
โโโ .streamlit/
    โโโ config.toml  โ (ุงุฎุชูุงุฑู) ูุชุฎุตูุต Streamlit
```

---

## ๐ ููุฎูุต ูุง ุฃูุฌุฒูุงู

| ุงูููุฒุฉ | ุงูุญุงูุฉ |
|--------|--------|
| ูุงุฌูุฉ Streamlit ุชูุงุนููุฉ | โ ุฌุงูุฒุฉ |
| ุฏุนู TSPLIB | โ |
| ููุงุฑูุฉ ูุน ุงูุญู ุงูุฃูุซู | โ |
| ูุดุฑ ุนูู Streamlit Cloud | ๐ ุฌุงูุฒ ูููุดุฑ |
| ุฏุนู ุงููุณุงูุงุช ุงูุฌููุฉ | โ |
| ูููุฐุฌ ุชุนููู ุนููู ูุชุญุณูู ุงูุงูุชุจุงู | โ (ูุจุณุท) |
| ุชุตุฏูุฑ CSV ู PNG | โ |

---

## ๐ ุงูุฎุทูุฉ ุงูุชุงููุฉ: ุงุจุฏุฃ ุจุงููุดุฑ!

1. **ุฃูุดุฆ ูุณุชูุฏุน GitHub** ุจุงุณู `tsp-geoattention`
2. **ุฃุถู ุงููููุงุช** ููุง ูู ููุถุญ
3. **ุงุฐูุจ ุฅูู Streamlit Cloud** ูุงูุดุฑ ุงูุชุทุจูู
4. **ุดุงุฑู ุงูุฑุงุจุท** ูุน ุงูุนุงูู!

---

ุฏุฏุฏ
ููุชุงุฒ! ุฅููู ุงููููุงุช ุงูููุงุฆูุฉ ุงูุชู ุณุชููู ุจูุง ูุดุฑูุนู ุจุงุญุชุฑุงููุฉ:

---

## ๐ 1. `README.md` โ ูุซุงุฆู ุงููุณุชูุฏุน

```markdown
# ๐บ๏ธ TSP-GeoAttention Solver

ุญู ูุฌูู ูุจุชูุฑ ููุณุฃูุฉ ุงูุจุงุฆุน ุงููุชุฌูู (TSP) ูุฌูุน ุจูู **ุงูููุฏุณุฉ ุงูููุงููุฉ**ุ **ูุจุฏุฃ ุงููุนู ุงูุฃุฏูู ูู ุงูููุฒูุงุก**ุ ู**ุขููุฉ ุงูุงูุชุจุงู ูู ููุงุฐุฌ ุงูุชุฑุงูุณููุฑูุฑ**.

![TSP Demo](https://via.placeholder.com/800x400?text=TSP-GeoAttention+Demo) <!-- ุงุณุชุจุฏู ูุงุญููุง ุจุตูุฑุฉ ุญููููุฉ -->

## โจ ุงูููุฒุงุช

- **ูุงุฌูุฉ ุชูุงุนููุฉ** ุนุจุฑ Streamlit (ุฑุณู ูุฏููุ ุจูุงูุงุช ุนุดูุงุฆูุฉุ ูููุงุช TSPLIB)
- **ุฏุนู ููุนูู ูู ุงููุณุงูุงุช**:
  - ุฅูููุฏูุฉ (ูููุดุงูู ุงูุชุฌุฑูุฏูุฉ)
  - ุฌููุฉ (Great-circle) ูููุฏู ุงูุญููููุฉ (ุจุฅุญุฏุงุซูุงุช ุฎุท ุงูุทูู/ุงูุนุฑุถ)
- **ููุงุฑูุฉ ุชููุงุฆูุฉ ูุน ุงูุญู ุงูุฃูุซู** (ูู โค 10 ูุฏู)
- **ุฎูุงุฑุฒููุฉ ุชูุฑูุจูุฉ ุฐููุฉ**:
  - ุชูุณูู ุงููุฏููุฉ ุฅูู ุฃุญูุงุก (ุฎูุงูุง)
  - ูุณุญ ุญูุฒููู ูู ุงููุญูุท ุฅูู ุงููุฑูุฒ
  - ุงูุชุจุงู ุฏููุงูููู ูุงุฎุชูุงุฑ ุฃูุถู ุงูุงูุชูุงูุงุช
- **ุชุตุฏูุฑ ุงููุชุงุฆุฌ** ุจุตูุบุชู CSV ู PNG
- **ูุงุจู ูููุดุฑ ููุฑูุง** ุนูู Streamlit Cloud

## ๐ ุงูุชุดุบูู ุงููุญูู

1. **ุชูุตูุจ ุงููุชุทูุจุงุช**:
   ```bash
   pip install -r requirements.txt
   ```

2. **ุชุดุบูู ุงูุชุทุจูู**:
   ```bash
   streamlit run app.py
   ```

3. ุงูุชุญ ุงููุชุตูุญ ุนูู: `http://localhost:8501`

## โ๏ธ ุงููุดุฑ ุนูู Streamlit Cloud

1. ุฃูุดุฆ ูุณุชูุฏุนูุง ุนูู GitHub ุจุงุณู `tsp-geoattention`
2. ุฃุถู ุฌููุน ูููุงุช ุงููุดุฑูุน
3. ุงุฐูุจ ุฅูู [Streamlit Cloud](https://streamlit.io/cloud)
4. ุงุฎุชุฑ ุงููุณุชูุฏุน ูุงููุฑ **Deploy**

> ูุซุงู ูุจุงุดุฑ: [https://your-username.streamlit.app](https://your-username.streamlit.app)

## ๐ ูููู ุงููุดุฑูุน

```
tsp-geoattention/
โโโ app.py                 # ูุงุฌูุฉ Streamlit
โโโ tsp_solver.py          # ููุทู ุงูุญู ุงููุฌูู
โโโ requirements.txt       # ุงูุชุจุนูุงุช
โโโ README.md              # ูุฐุง ุงูููู
โโโ data/                  # (ุงุฎุชูุงุฑู) ูููุงุช TSPLIB
    โโโ berlin52.tsp
```

## ๐งช ุฃูุซูุฉ ุงุฎุชุจุงุฑ

- ุฌุฑูุจ `berlin52.tsp` ูู [TSPLIB](https://www.math.uwaterloo.ca/tsp/world/countries.html)
- ุฃุถู 8 ูุฏู ูุฏูููุง ููุงุฑู ุงูุญู ุงูุชูุฑูุจู ูุน ุงูุฃูุซู
- ุงุณุชุฎุฏู ุฅุญุฏุงุซูุงุช ุฌุบุฑุงููุฉ ุญููููุฉ (ูุซู: `(35.8617, 104.1954)` ููุตูู)

## ๐ ุงูุชุฑุฎูุต

MIT License โ ุญุฑูุฉ ุงูุงุณุชุฎุฏุงู ูุงูุชุนุฏูู ูุฃุบุฑุงุถ ุชุนููููุฉ ูุชุฌุงุฑูุฉ.

---

> ุทููุฑ ุจูุงุณุทุฉ [ุงุณูู] โ ูุณุชูุญู ูู ุฑุคูุฉ ุชูุญูุฏ ุงูููุฒูุงุกุ ุงูููุฏุณุฉุ ูุงูุฐูุงุก ุงูุงุตุทูุงุนู.
```

---

## โ๏ธ 2. `.streamlit/config.toml` โ ุชุฎุตูุต Streamlit

ุฃูุดุฆ ูุฌูุฏูุง ุจุงุณู `.streamlit` ูู ุฌุฐุฑ ุงููุดุฑูุนุ ูุถุน ุจุฏุงุฎูู:

```toml
[server]
headless = true
port = 8501

[browser]
gatherUsageStats = false

[theme]
primaryColor = "#FF4B4B"
backgroundColor = "#FFFFFF"
secondaryBackgroundColor = "#F0F2F6"
textColor = "#262730"
font = "sans serif"
```

> ูุฐุง ูุนุทู ูุงุฌูุฉ ุฌูููุฉ ุจุฃููุงู ูุชูุงุณูุฉ ููุนุทูู ุฌูุน ุงูุฅุญุตุงุฆูุงุช.

---

## ๐ฆ 3. ุชุญุฏูุซ `requirements.txt` (ุงูููุงุฆู)

```txt
streamlit==1.32.0
numpy==1.26.4
matplotlib==3.8.3
scikit-learn==1.4.0
pandas==2.2.1
```

> ุฃุถู `torch==2.2.0` ูุงุญููุง ุฅุฐุง ุทููุฑุช ูููุฐุฌ ุชุนููู ุนููู ุฃุนูู.

---
---

- ูุชุงุจุฉ ูุญุฏุงุช ุงุฎุชุจุงุฑ (unit tests)ุ
- ุฅุถุงูุฉ ุฏุนู ููุบุฉ ุงูุนุฑุจูุฉ ูู ุงููุงุฌูุฉุ
- ุฑุจุท ุงูุชุทุจูู ุจู Google Maps ููุฅุญุฏุงุซูุงุช ุงูุญููููุฉุ


